<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thailand Ultimate Guide - Complete Editie</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* --- STYLING --- */
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; overflow: hidden; background: #f0f0f0; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        /* Menu Knop */
        #toggle-btn {
            position: absolute; top: 15px; right: 15px;
            background: #fff; color: #333;
            padding: 10px 16px; border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000; border: none;
            font-weight: 700; font-size: 14px;
            cursor: pointer; display: flex; align-items: center; gap: 6px;
            transition: transform 0.2s;
        }
        #toggle-btn:active { transform: scale(0.95); }

        /* Sidebar / Filter Menu */
        #controls {
            position: absolute; top: 0; right: 0;
            height: 100vh; width: 350px;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: -5px 0 25px rgba(0,0,0,0.2);
            z-index: 2000;
            display: flex; flex-direction: column;
            transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #controls.active { transform: translateX(0); }

        /* Mobiele aanpassing */
        @media (max-width: 600px) {
            #controls { width: 100%; max-width: 100%; }
        }

        .sidebar-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }
        .sidebar-footer { padding: 15px 20px; border-top: 1px solid #eee; background: #fff; }

        h2 { margin: 0; font-size: 18px; color: #222; }
        h4 { margin: 20px 0 10px 0; font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; font-weight: 800; border-bottom: 1px solid #f0f0f0; padding-bottom: 5px; }
        .close-btn { background: none; border: none; font-size: 28px; color: #555; padding: 0 10px; cursor: pointer; }

        /* Calculator */
        .calc-box { background: #eef5ff; padding: 15px; border-radius: 12px; border: 1px solid #d0e3ff; }
        .calc-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .calc-input { flex: 1; }
        .calc-input label { display: block; font-size: 10px; font-weight: bold; color: #555; margin-bottom: 3px; }
        .calc-input input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        .rate-display { font-size: 13px; color: #0056b3; font-weight: bold; text-align: center; margin-top: 5px; }
        
        /* Inputs & Filters */
        #searchInput { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; background: #f9f9f9; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; }
        .filter-group label { display: flex; align-items: center; margin-bottom: 12px; cursor: pointer; font-size: 15px; color: #333; }
        input[type="checkbox"] { width: 20px; height: 20px; margin-right: 12px; accent-color: #007bff; border-radius: 4px; }
        input[type=range] { width: 100%; margin: 10px 0; accent-color: #007bff; }
        select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; background: #f9f9f9; font-size: 14px; }
        
        /* Pins & Icons */
        .custom-pin {
            border-radius: 50% 50% 50% 0; border: 3px solid #fff; width: 40px; height: 40px;
            transform: rotate(-45deg); display: flex !important; align-items: center; justify-content: center;
            box-shadow: 2px 2px 6px rgba(0,0,0,0.3); position: relative; transition: transform 0.2s;
        }
        .pin-icon { transform: rotate(45deg); font-size: 18px; line-height: 1; }
        .rank-badge {
            position: absolute; top: -6px; right: -6px; background: #fff; color: #000; border: 2px solid #333;
            border-radius: 50%; width: 18px; height: 18px; font-size: 10px; font-weight: 900;
            display: flex; align-items: center; justify-content: center; transform: rotate(45deg); z-index: 10;
        }
        
        /* Kleuren */
        .marker-sight { background-color: #007bff; }   /* Blauw */
        .marker-food { background-color: #dc3545; }    /* Rood */
        .marker-activity { background-color: #9c27b0; } /* Paars */
        .marker-hike { background-color: #28a745; }    /* Groen */
        .legend-color { display: inline-block; width: 14px; height: 14px; border-radius: 50%; margin-right: 8px; flex-shrink: 0; }
        .c-sight { background-color: #007bff; } .c-food { background-color: #dc3545; } .c-act { background-color: #9c27b0; } .c-hike { background-color: #28a745; }

        /* Popup */
        .leaflet-popup-content-wrapper { border-radius: 12px; }
        .popup-content { min-width: 260px; padding-bottom: 5px; }
        .popup-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 5px; }
        .popup-header h3 { margin: 0; font-size: 16px; color: #222; width: 85%; }
        .fav-btn { cursor: pointer; font-size: 20px; background: none; border: none; padding: 0; line-height: 1; transition: transform 0.2s; }
        .fav-btn:active { transform: scale(1.3); }
        .fav-active { color: red; } .fav-inactive { color: #ccc; }
        .desc { font-size: 13px; color: #555; margin-bottom: 10px; line-height: 1.4; }
        .meta-row { display: flex; justify-content: space-between; align-items: center; background: #f9f9f9; padding: 8px; border-radius: 6px; margin-bottom: 10px; font-size: 12px; font-weight: 600; }
        
        /* Knoppen */
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .full-width { grid-column: 1 / -1; }
        .popup-btn { display: flex; align-items: center; justify-content: center; text-decoration: none; border-radius: 6px; padding: 10px; font-size: 12px; font-weight: bold; color: white; gap: 6px; transition: opacity 0.2s; }
        .popup-btn:hover { opacity: 0.9; }
        .btn-google { background: #4285F4; } .btn-nav { background: #34A853; } .btn-yt { background: #FF0000; } .btn-wiki { background: #555; }
        
        .loc-btn { width: 100%; padding: 14px; background: #222; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>

    <button id="toggle-btn" onclick="toggleMenu()">‚öôÔ∏è Filters & Tools</button>

    <div id="controls">
        <div class="sidebar-header">
            <h2>üáπüá≠ Thai Ultimate Guide</h2>
            <button class="close-btn" onclick="toggleMenu()">√ó</button>
        </div>

        <div class="sidebar-content">
            <input type="text" id="searchInput" placeholder="üîç Zoek op naam..." onkeyup="renderMarkers()">

            <h4>üßÆ ATM & Koers Calculator</h4>
            <div class="calc-box">
                <div class="calc-row">
                    <div class="calc-input">
                        <label>Gepind (THB)</label>
                        <input type="number" id="calcTHB" placeholder="10000" oninput="calculateRate()">
                    </div>
                    <div class="calc-input">
                        <label>Afgeschreven (‚Ç¨)</label>
                        <input type="number" id="calcEUR" placeholder="275" oninput="calculateRate()">
                    </div>
                </div>
                <div id="rateResult" class="rate-display">Standaard koers: 100 THB = ‚Ç¨ 2.70</div>
            </div>

            <h4>‚ù§Ô∏è Jouw Reis</h4>
            <div class="filter-group">
                <label><input type="checkbox" id="favFilter" onchange="renderMarkers()"> Toon alleen Favorieten</label>
            </div>

            <h4>üèÜ Toplijst (1-50)</h4>
            <div style="display:flex; justify-content:space-between; font-weight:bold; color:#007bff; margin-bottom:5px;">
                <span>Top</span><span id="rankVal">50</span>
            </div>
            <input type="range" id="rankSlider" min="1" max="50" value="50" oninput="updateSliderVal(); renderMarkers()">

            <h4>Categorie√´n</h4>
            <div class="filter-group">
                <label><input type="checkbox" name="cat" value="sight" checked onchange="renderMarkers()"> <span class="legend-color c-sight"></span> Bezienswaardigheden</label>
                <label><input type="checkbox" name="cat" value="food" checked onchange="renderMarkers()"> <span class="legend-color c-food"></span> Eten & Drinken</label>
                <label><input type="checkbox" name="cat" value="activity" checked onchange="renderMarkers()"> <span class="legend-color c-act"></span> Activiteiten</label>
                <label><input type="checkbox" name="cat" value="hike" checked onchange="renderMarkers()"> <span class="legend-color c-hike"></span> Wandelingen</label>
            </div>

            <h4>Type Ervaring</h4>
            <div class="filter-group">
                <label><input type="checkbox" name="tag" value="nature" checked onchange="renderMarkers()"> üå≥ Natuur</label>
                <label><input type="checkbox" name="tag" value="culture" checked onchange="renderMarkers()"> üèõÔ∏è Cultuur & Stad</label>
            </div>

            <h4>Regio's</h4>
            <div class="filter-group">
                <label><input type="checkbox" name="reg" value="bangkok" checked onchange="renderMarkers()"> Centraal & Bangkok</label>
                <label><input type="checkbox" name="reg" value="north" checked onchange="renderMarkers()"> Noord (Chiang Mai)</label>
                <label><input type="checkbox" name="reg" value="south" checked onchange="renderMarkers()"> Zuid (Eilanden)</label>
                <label><input type="checkbox" name="reg" value="west" checked onchange="renderMarkers()"> West (Kanchanaburi)</label>
                <label><input type="checkbox" name="reg" value="east" checked onchange="renderMarkers()"> Oost (Pattaya)</label>
            </div>

            <h4>Prijsklasse</h4>
            <select id="priceFilter" onchange="renderMarkers()">
                <option value="all">Alle prijzen</option>
                <option value="free">Gratis</option>
                <option value="cheap">Budget (< ‚Ç¨5)</option>
                <option value="mid">Gemiddeld (‚Ç¨5 - ‚Ç¨20)</option>
                <option value="high">Luxe (> ‚Ç¨20)</option>
            </select>
        </div>

        <div class="sidebar-footer">
            <button class="loc-btn" onclick="locateUser()">üìç Mijn Locatie</button>
            <div id="user-status" style="font-size: 11px; margin-top: 5px; color: #666; text-align: center;"></div>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- 1. SETUP ---
        const isMobile = window.innerWidth < 600;
        const initialZoom = isMobile ? 5 : 6;
        const map = L.map('map', { zoomControl: false }).setView([13.0000, 101.5000], initialZoom);
        L.control.zoom({ position: 'bottomright' }).addTo(map);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);

        function toggleMenu() { document.getElementById('controls').classList.toggle('active'); }
        if(isMobile) document.getElementById('controls').classList.remove('active');

        // --- 2. LOGICA (Storage, Koers, Favs) ---
        let favorites = JSON.parse(localStorage.getItem('thai_favs')) || [];
        let userRate = parseFloat(localStorage.getItem('thai_rate')) || 0; 
        let userLat = null;
        let userLng = null;

        if(localStorage.getItem('calc_thb')) document.getElementById('calcTHB').value = localStorage.getItem('calc_thb');
        if(localStorage.getItem('calc_eur')) document.getElementById('calcEUR').value = localStorage.getItem('calc_eur');
        if(userRate > 0) updateRateDisplay(userRate);

        function calculateRate() {
            const thb = parseFloat(document.getElementById('calcTHB').value);
            const eur = parseFloat(document.getElementById('calcEUR').value);
            if (thb && eur) {
                const rate100 = (eur / thb) * 100;
                userRate = rate100;
                localStorage.setItem('thai_rate', userRate);
                localStorage.setItem('calc_thb', thb);
                localStorage.setItem('calc_eur', eur);
                updateRateDisplay(rate100);
                renderMarkers();
            }
        }

        function updateRateDisplay(rate) {
            document.getElementById('rateResult').innerHTML = `Jouw koers: 100 THB = <b>‚Ç¨ ${rate.toFixed(2)}</b>`;
        }

        function toggleFav(id) {
            if (favorites.includes(id)) { favorites = favorites.filter(fav => fav !== id); } 
            else { favorites.push(id); }
            localStorage.setItem('thai_favs', JSON.stringify(favorites));
            
            const btn = document.getElementById(`fav-btn-${id}`);
            if(btn) {
                btn.className = favorites.includes(id) ? 'fav-btn fav-active' : 'fav-btn fav-inactive';
                btn.innerHTML = favorites.includes(id) ? '‚ù§Ô∏è' : 'ü§ç';
            }
            if(document.getElementById('favFilter').checked) renderMarkers();
        }

        // --- 3. DATABASE (Compleet) ---
        const locations = [
            // 1. BEZIENSWAARDIGHEDEN (SIGHTS)
            { id: 101, rank: 1, type: 'sight', tag: 'culture', region: 'bangkok', name: "The Grand Palace", lat: 13.7500, lng: 100.4915, price: "‚Ç¨ 13,50", desc: "Het offici√´le verblijf van de koningen van Siam." },
            { id: 102, rank: 2, type: 'sight', tag: 'culture', region: 'bangkok', name: "Wat Arun", lat: 13.7437, lng: 100.4888, price: "‚Ç¨ 5,40", desc: "Tempel van de Dageraad, iconisch om zijn centrale toren met porselein." },
            { id: 103, rank: 3, type: 'sight', tag: 'culture', region: 'bangkok', name: "Wat Pho", lat: 13.7465, lng: 100.4933, price: "‚Ç¨ 8,10", desc: "Huis van de liggende Boeddha en de eerste universiteit van Thailand." },
            { id: 104, rank: 4, type: 'sight', tag: 'culture', region: 'bangkok', name: "Chatuchak Weekend Market", lat: 13.7998, lng: 100.5504, price: "Gratis", desc: "Grootste markt met 15.000 kraampjes." },
            { id: 105, rank: 5, type: 'sight', tag: 'culture', region: 'bangkok', name: "Ayutthaya Historical Park", lat: 14.3532, lng: 100.5684, price: "‚Ç¨ 1,35", desc: "De oude hoofdstad, het hoogtepunt van de Siamese macht." },
            { id: 109, rank: 9, type: 'sight', tag: 'nature', region: 'west', name: "Erawan National Park", lat: 14.3755, lng: 99.1440, price: "‚Ç¨ 8,10", desc: "Sprookjesachtige waterval met zeven niveaus." },
            { id: 119, rank: 19, type: 'sight', tag: 'culture', region: 'bangkok', name: "Asiatique The Riverfront", lat: 13.7045, lng: 100.5034, price: "Gratis", desc: "Shoppen en dineren aan de rivier in oude pakhuizen." },
            { id: 125, rank: 25, type: 'sight', tag: 'culture', region: 'west', name: "Dragon Descendants Museum", lat: 14.4776, lng: 100.1106, price: "‚Ç¨ 13,00", desc: "Enorm drakenmuseum dat de Chinees-Thaise geschiedenis toont." },
            { id: 131, rank: 31, type: 'sight', tag: 'culture', region: 'north', name: "Wat Phra That Doi Suthep", lat: 18.8048, lng: 98.9216, price: "‚Ç¨ 0,80", desc: "Heilige tempel op een berg met uitzicht over Chiang Mai." },
            { id: 132, rank: 32, type: 'sight', tag: 'culture', region: 'north', name: "Wat Rong Khun (Witte Tempel)", lat: 19.8243, lng: 99.7632, price: "‚Ç¨ 2,70", desc: "Een tempel als kunstwerk, symboliseert de overgang van de hel naar de hemel." },
            { id: 134, rank: 34, type: 'sight', tag: 'culture', region: 'north', name: "Wat Chedi Luang", lat: 18.7870, lng: 98.9866, price: "‚Ç¨ 1,10", desc: "De grote ru√Øne-stoepa in het oude centrum van Chiang Mai." },
            { id: 135, rank: 35, type: 'sight', tag: 'culture', region: 'north', name: "Baan Dam (Black House)", lat: 19.9922, lng: 99.8605, price: "‚Ç¨ 2,15", desc: "Duister en artistiek museumcomplex, de tegenhanger van de Witte Tempel." },
            { id: 137, rank: 37, type: 'sight', tag: 'culture', region: 'north', name: "Wat Rong Suea Ten (Blauwe Tempel)", lat: 19.9233, lng: 99.8419, price: "Gratis", desc: "Opvallende blauwe tempel met een indrukwekkend interieur." },
            { id: 143, rank: 43, type: 'sight', tag: 'culture', region: 'north', name: "Wat Chaloem Phra Kiat", lat: 18.7413, lng: 99.5436, price: "‚Ç¨ 5,40", desc: "Zwevende pagodes op kalksteenpieken, een surrealistisch gezicht." },
            { id: 151, rank: 51, type: 'sight', tag: 'culture', region: 'east', name: "Phanom Rung Historical Park", lat: 14.5323, lng: 102.9426, price: "‚Ç¨ 2,70", desc: "Khmer-tempel op de rand van een uitgedoofde vulkaan." },
            { id: 152, rank: 52, type: 'sight', tag: 'culture', region: 'east', name: "Phimai Historical Park", lat: 15.2203, lng: 102.4939, price: "‚Ç¨ 2,70", desc: "De grootste Khmer-tempel in Thailand." },
            { id: 153, rank: 53, type: 'sight', tag: 'nature', region: 'east', name: "Sam Pan Bok", lat: 15.8033, lng: 105.3855, price: "Gratis", desc: "De 'Grand Canyon' van Thailand in de Mekong-rivier." },
            { id: 154, rank: 54, type: 'sight', tag: 'nature', region: 'east', name: "Red Lotus Lake", lat: 17.2210, lng: 103.0381, price: "‚Ç¨ 10,00", desc: "Meer vol roze waterlelies (seizoen: dec-feb)." },
            { id: 155, rank: 55, type: 'sight', tag: 'culture', region: 'east', name: "Wat Phu Tok", lat: 18.1319, lng: 103.8827, price: "Gratis", desc: "Tempel met houten loopbruggen rondom een zandsteenrots." },
            { id: 156, rank: 56, type: 'sight', tag: 'culture', region: 'east', name: "Sala Keoku", lat: 17.8864, lng: 102.7786, price: "‚Ç¨ 1,10", desc: "Beeldentuin met bizarre, enorme cementen beelden." },
            { id: 172, rank: 72, type: 'sight', tag: 'culture', region: 'west', name: "Bridge Over the River Kwai", lat: 14.0410, lng: 99.5042, price: "Gratis", desc: "Historische brug van de Dodenspoorlijn." },
            { id: 173, rank: 73, type: 'sight', tag: 'culture', region: 'west', name: "Hellfire Pass", lat: 14.3528, lng: 98.9536, price: "Gratis", desc: "Indrukwekkend herdenkingsmuseum en wandelroute." },
            { id: 181, rank: 81, type: 'sight', tag: 'nature', region: 'south', name: "Phi Phi Islands (Maya Bay)", lat: 7.6775, lng: 98.7663, price: "‚Ç¨ 10,80", desc: "Wereldberoemde baai, nu ecologisch herstellende." },
            { id: 183, rank: 83, type: 'sight', tag: 'nature', region: 'south', name: "Samet Nangshe Viewpoint", lat: 8.2406, lng: 98.4485, price: "‚Ç¨ 0,80", desc: "Het ultieme uitzicht over de baai van Phang Nga." },
            { id: 185, rank: 85, type: 'sight', tag: 'nature', region: 'south', name: "Similan Islands", lat: 8.6536, lng: 97.6433, price: "‚Ç¨ 13,50", desc: "Wereldklasse duik- en snorkelplek (gesloten mei-okt)." },
            { id: 187, rank: 87, type: 'sight', tag: 'nature', region: 'south', name: "Koh Lipe", lat: 6.4884, lng: 99.3039, price: "‚Ç¨ 5,40", desc: "De 'Malediven van Thailand' met turquoise water." },
            { id: 188, rank: 88, type: 'sight', tag: 'nature', region: 'south', name: "Koh Tao", lat: 10.0956, lng: 99.8404, price: "Gratis", desc: "Het eiland om te leren duiken." },
            { id: 189, rank: 89, type: 'sight', tag: 'nature', region: 'south', name: "Ang Thong National Marine Park", lat: 9.6150, lng: 99.6766, price: "‚Ç¨ 8,10", desc: "Archipel van 42 eilanden, bekend van 'The Beach'." },
            { id: 194, rank: 94, type: 'sight', tag: 'nature', region: 'south', name: "Aiyerweng Skywalk", lat: 5.9757, lng: 101.1825, price: "‚Ç¨ 5,40", desc: "Glazen platform met uitzicht over de 'Zee van Mist' in Betong." },
            { id: 202, rank: 102, type: 'sight', tag: 'nature', region: 'east', name: "Koh Kood", lat: 11.6667, lng: 102.5667, price: "Gratis", desc: "Rustig eiland met kristalhelder water." },
            { id: 207, rank: 107, type: 'sight', tag: 'culture', region: 'east', name: "Sanctuary of Truth", lat: 12.9727, lng: 100.8891, price: "‚Ç¨ 13,50", desc: "Gigantisch houten monument aan zee, volledig handgesneden." },
            { id: 214, rank: 114, type: 'sight', tag: 'nature', region: 'east', name: "Koh Samet", lat: 12.5683, lng: 101.4526, price: "‚Ç¨ 5,40", desc: "Populair eiland voor een weekend weg vanuit Bangkok." },
            { id: 215, rank: 115, type: 'sight', tag: 'culture', region: 'north', name: "Wat Phra That Doi Kong Mu", lat: 19.3003, lng: 97.9606, price: "Gratis", desc: "Tempel met Shan-invloeden en uitzicht over Mae Hong Son." },
            { id: 223, rank: 123, type: 'sight', tag: 'nature', region: 'north', name: "Elephant Nature Park", lat: 19.2155, lng: 98.8606, price: "‚Ç¨ 67,50", desc: "Pionier in ethische olifantenopvang." },
            { id: 228, rank: 128, type: 'sight', tag: 'nature', region: 'east', name: "Koh Chang", lat: 12.0406, lng: 102.3023, price: "Gratis", desc: "Groot eiland met jungle en stranden." },
            { id: 246, rank: 146, type: 'sight', tag: 'culture', region: 'north', name: "Su Tong Pae Bridge", lat: 19.3879, lng: 97.9542, price: "Gratis", desc: "Bamboe brug door de rijstvelden." },

            // 2. ETEN (FOOD)
            { id: 301, rank: 1, type: 'food', tag: 'culture', region: 'bangkok', name: "Raan Jay Fai", lat: 13.7525, lng: 100.5048, price: "‚Ç¨ 35,00", desc: "Krabomelet van de straatchef met skibril." },
            { id: 302, rank: 2, type: 'food', tag: 'culture', region: 'bangkok', name: "Wattana Panich", lat: 13.7341, lng: 100.5876, price: "‚Ç¨ 4,00", desc: "Rundvleessoep die al 40 jaar suddert." },
            { id: 303, rank: 3, type: 'food', tag: 'culture', region: 'bangkok', name: "Guay Jub Ouan Pochana", lat: 13.7408, lng: 100.5094, price: "‚Ç¨ 2,50", desc: "Peperige noedelsoep met krokante varkensbuik." },
            { id: 304, rank: 4, type: 'food', tag: 'culture', region: 'bangkok', name: "Khao Gaeng Jek Pui", lat: 13.7435, lng: 100.5097, price: "‚Ç¨ 2,00", desc: "Curry eten op rode krukjes zonder tafels." },
            { id: 305, rank: 5, type: 'food', tag: 'culture', region: 'bangkok', name: "T&K Seafood", lat: 13.7410, lng: 100.5085, price: "‚Ç¨ 10,00", desc: "Groene shirts, gegrilde garnalen en chaos." },
            { id: 306, rank: 6, type: 'food', tag: 'culture', region: 'bangkok', name: "Lim Lao Ngow", lat: 13.7377, lng: 100.5117, price: "‚Ç¨ 2,50", desc: "Beroemde verende visballetjes." },
            { id: 307, rank: 7, type: 'food', tag: 'culture', region: 'bangkok', name: "Jok Prince", lat: 13.7196, lng: 100.5153, price: "‚Ç¨ 1,50", desc: "Rijstepap met een rokerige smaak." },
            { id: 308, rank: 8, type: 'food', tag: 'culture', region: 'bangkok', name: "Nai Mong Hoi Tod", lat: 13.7413, lng: 100.5099, price: "‚Ç¨ 4,00", desc: "De beste oesteromelet van de stad." },
            { id: 309, rank: 9, type: 'food', tag: 'culture', region: 'bangkok', name: "Kor Panich", lat: 13.7533, lng: 100.4996, price: "‚Ç¨ 3,00", desc: "Legendarische Mango Sticky Rice." },
            { id: 310, rank: 10, type: 'food', tag: 'culture', region: 'bangkok', name: "Somsak Pu Ob", lat: 13.7224, lng: 100.4965, price: "‚Ç¨ 8,50", desc: "Glasnoedels met krab uit een aarden pot." },
            { id: 311, rank: 11, type: 'food', tag: 'culture', region: 'bangkok', name: "Ann Guay Tiew Kua Gai", lat: 13.7456, lng: 100.5059, price: "‚Ç¨ 2,50", desc: "Krokant gebakken kipnoedels." },
            { id: 312, rank: 12, type: 'food', tag: 'culture', region: 'bangkok', name: "Som Tam Jay So", lat: 13.7266, lng: 100.5332, price: "‚Ç¨ 3,00", desc: "Extreem pittige authentieke Som Tam." },
            { id: 313, rank: 13, type: 'food', tag: 'culture', region: 'bangkok', name: "Jeh O Chula", lat: 13.7425, lng: 100.5225, price: "‚Ç¨ 7,00", desc: "Tom Yum Mama noedels 's nachts." },
            { id: 314, rank: 14, type: 'food', tag: 'culture', region: 'bangkok', name: "Rung Rueang Pork Noodle", lat: 13.7291, lng: 100.5705, price: "‚Ç¨ 2,50", desc: "Varkensnoedels met gehakt en visballen." },
            { id: 315, rank: 15, type: 'food', tag: 'culture', region: 'bangkok', name: "Polo Fried Chicken", lat: 13.7366, lng: 100.5458, price: "‚Ç¨ 6,00", desc: "Gefrituurde kip met bergen knoflook." },
            { id: 316, rank: 16, type: 'food', tag: 'culture', region: 'bangkok', name: "Charoen Saeng Silom", lat: 13.7226, lng: 100.5169, price: "‚Ç¨ 4,00", desc: "Gestoofde varkenspoot, boterzacht." },
            { id: 317, rank: 17, type: 'food', tag: 'culture', region: 'bangkok', name: "Thanee Khao Moo Daeng", lat: 13.7788, lng: 100.5444, price: "‚Ç¨ 2,50", desc: "Krokant varkensspek en rode saus." },
            { id: 318, rank: 18, type: 'food', tag: 'culture', region: 'bangkok', name: "Ong Tong Khao Soi", lat: 13.7807, lng: 100.5446, price: "‚Ç¨ 3,50", desc: "Noord-Thaise currynoedels in Bangkok." },
            { id: 319, rank: 19, type: 'food', tag: 'culture', region: 'bangkok', name: "Lay Lao", lat: 13.7801, lng: 100.5448, price: "‚Ç¨ 8,00", desc: "Seafood en Isaan gerechten." },
            { id: 320, rank: 20, type: 'food', tag: 'culture', region: 'bangkok', name: "Phed Mark", lat: 13.7188, lng: 100.5856, price: "‚Ç¨ 4,00", desc: "De heetste Pad Kaprao van de stad." },
            { id: 321, rank: 21, type: 'food', tag: 'culture', region: 'bangkok', name: "Sorn", lat: 13.7268, lng: 100.5698, price: "‚Ç¨ 150,00", desc: "2-sterren Zuid-Thaise fine dining." },
            { id: 338, rank: 38, type: 'food', tag: 'culture', region: 'bangkok', name: "Here Hai", lat: 13.7346, lng: 100.5833, price: "‚Ç¨ 12,00", desc: "Gebakken rijst met waanzinnig veel krab." },
            { id: 350, rank: 50, type: 'food', tag: 'culture', region: 'bangkok', name: "Krua Apsorn", lat: 13.7578, lng: 100.5037, price: "‚Ç¨ 8,00", desc: "Krabomelet favoriet bij de koninklijke familie." },
            { id: 353, rank: 53, type: 'food', tag: 'culture', region: 'bangkok', name: "Go-Ang Pratunam", lat: 13.7495, lng: 100.5413, price: "‚Ç¨ 2,00", desc: "De roze kiprijstkraam." },
            { id: 376, rank: 76, type: 'food', tag: 'culture', region: 'bangkok', name: "Ruan Thai Kung Pao", lat: 14.2882, lng: 100.5898, price: "‚Ç¨ 25,00", desc: "Gigantische riviergarnalen in Ayutthaya." },
            { id: 396, rank: 96, type: 'food', tag: 'culture', region: 'north', name: "Khao Soi Mae Sai", lat: 18.7996, lng: 98.9752, price: "‚Ç¨ 1,50", desc: "De beste Khao Soi bouillon van Chiang Mai." },
            { id: 397, rank: 97, type: 'food', tag: 'culture', region: 'north', name: "Khao Soi Khun Yai", lat: 18.7953, lng: 98.9831, price: "‚Ç¨ 1,50", desc: "Oma's Khao Soi, alleen lunch." },
            { id: 400, rank: 100, type: 'food', tag: 'culture', region: 'north', name: "SP Chicken", lat: 18.7885, lng: 98.9806, price: "‚Ç¨ 5,00", desc: "Kleine geroosterde kippetjes." },
            { id: 471, rank: 171, type: 'food', tag: 'culture', region: 'south', name: "Raya Restaurant", lat: 7.8858, lng: 98.3909, price: "‚Ç¨ 15,00", desc: "Krabcurry in een oud herenhuis in Phuket." },
            { id: 477, rank: 177, type: 'food', tag: 'culture', region: 'south', name: "Mee Ton Poe", lat: 7.8807, lng: 98.3975, price: "‚Ç¨ 2,50", desc: "Hokkien noedels in Phuket." },

            // 3. ACTIVITEITEN (ACTIVITY)
            { id: 501, rank: 1, type: 'activity', tag: 'culture', region: 'bangkok', name: "Thaise Massage (Wat Pho)", lat: 13.7460, lng: 100.4930, price: "‚Ç¨ 8,00", desc: "De bakermat van de traditionele massage." },
            { id: 502, rank: 2, type: 'activity', tag: 'culture', region: 'north', name: "Monk Chat (Chiang Mai)", lat: 18.7883, lng: 98.9853, price: "Gratis", desc: "Praat met monniken over het leven." },
            { id: 503, rank: 3, type: 'activity', tag: 'culture', region: 'bangkok', name: "Muay Thai Training", lat: 13.7607, lng: 100.5085, price: "‚Ç¨ 15,00", desc: "Train de nationale vechtsport." },
            { id: 504, rank: 4, type: 'activity', tag: 'nature', region: 'north', name: "Elephant Nature Park", lat: 19.2155, lng: 98.8606, price: "‚Ç¨ 67,50", desc: "Diervriendelijk reservaat (geen rijden)." },
            { id: 505, rank: 5, type: 'activity', tag: 'culture', region: 'bangkok', name: "Kookcursus (Blue Elephant)", lat: 13.7196, lng: 100.5161, price: "‚Ç¨ 75,00", desc: "High-end kookschool met marktbezoek." },
            { id: 506, rank: 6, type: 'activity', tag: 'nature', region: 'south', name: "Duiken (Koh Tao)", lat: 10.0956, lng: 99.8404, price: "‚Ç¨ 80,00", desc: "Haal je PADI op het duikeiland." },
            { id: 507, rank: 7, type: 'activity', tag: 'nature', region: 'south', name: "Gibbon Rehabilitation Project", lat: 8.0366, lng: 98.3644, price: "Donatie", desc: "Rehabilitatie van gibbons in Phuket." },
            { id: 508, rank: 8, type: 'activity', tag: 'culture', region: 'north', name: "Bamboe Weven", lat: 18.7904, lng: 98.9847, price: "‚Ç¨ 20,00", desc: "Leer traditioneel handwerk in Chiang Mai." },
            { id: 509, rank: 9, type: 'activity', tag: 'nature', region: 'south', name: "Soi Dog Foundation", lat: 8.1633, lng: 98.2933, price: "Gratis", desc: "Knuffel en verzorg geredde straathonden." },
            { id: 510, rank: 10, type: 'activity', tag: 'nature', region: 'south', name: "Zeekajakken Phang Nga", lat: 8.2747, lng: 98.5012, price: "‚Ç¨ 35,00", desc: "Verken grotten en lagunes per kano." },
            
            // 4. WANDELINGEN (HIKE) - TOP 50 uit bestand
            { id: 601, rank: 1, type: 'hike', tag: 'nature', region: 'north', name: "Kew Mae Pan Nature Trail", lat: 18.5559, lng: 98.4822, price: "‚Ç¨ 13,50", desc: "Spectaculair pad langs de bergkam op de hoogste top van Thailand." },
            { id: 602, rank: 2, type: 'hike', tag: 'nature', region: 'north', name: "Ang Ka Nature Trail", lat: 18.5886, lng: 98.4862, price: "Gratis", desc: "Vlonderpad door een oeroud mosbos." },
            { id: 603, rank: 3, type: 'hike', tag: 'nature', region: 'north', name: "Doi Luang Chiang Dao Summit", lat: 19.3975, lng: 98.8839, price: "‚Ç¨ 40,00", desc: "Uitdagende kalksteenbeklimming naar de op twee na hoogste top." },
            { id: 604, rank: 4, type: 'hike', tag: 'nature', region: 'north', name: "Monk's Trail (Wat Pha Lat)", lat: 18.7993, lng: 98.9436, price: "Gratis", desc: "Pelgrimspad naar een verborgen tempel met watervallen." },
            { id: 605, rank: 5, type: 'hike', tag: 'nature', region: 'north', name: "Pha Dok Siew Nature Trail", lat: 18.5332, lng: 98.5333, price: "‚Ç¨ 5,40", desc: "Culturele tocht langs rijstterrassen en watervallen van de Karen-stam." },
            { id: 606, rank: 6, type: 'hike', tag: 'nature', region: 'north', name: "Phu Chi Fa Summit", lat: 19.8506, lng: 100.4533, price: "Gratis", desc: "Korte klim naar een klifrand aan de grens met Laos." },
            { id: 607, rank: 7, type: 'hike', tag: 'nature', region: 'north', name: "Pai Canyon (Kong Lan)", lat: 19.3067, lng: 98.4530, price: "Gratis", desc: "Smalle zandsteenruggen met steile afgronden." },
            { id: 608, rank: 8, type: 'hike', tag: 'nature', region: 'north', name: "Doi Suthep Summit Hike", lat: 18.8000, lng: 98.9000, price: "Gratis", desc: "Steile jungletocht naar de heilige bergtempel." },
            { id: 609, rank: 9, type: 'hike', tag: 'nature', region: 'north', name: "Huay Tung Tao Circular Trek", lat: 18.8667, lng: 98.9333, price: "‚Ç¨ 1,35", desc: "Lus rond een stuwmeer met uitzicht op de bergen." },
            { id: 610, rank: 10, type: 'hike', tag: 'nature', region: 'north', name: "Doi Pui Nature Trail", lat: 18.8164, lng: 98.8925, price: "Gratis", desc: "Wandeling door dennenbossen en Hmong-stamgebieden." },
            { id: 611, rank: 11, type: 'hike', tag: 'nature', region: 'north', name: "Khun Korn Waterfall", lat: 19.8667, lng: 99.5833, price: "Gratis", desc: "Wandeling door bamboebossen naar de hoogste waterval van Chiang Rai." },
            { id: 612, rank: 12, type: 'hike', tag: 'nature', region: 'north', name: "Doi Mon Jong", lat: 17.5503, lng: 98.5367, price: "‚Ç¨ 80,00", desc: "Gouden grasruggen die lijken op een leeuwenkop." },
            { id: 613, rank: 13, type: 'hike', tag: 'nature', region: 'north', name: "Doi Pha Hom Pok", lat: 20.0433, lng: 99.1436, price: "‚Ç¨ 8,10", desc: "De op een na hoogste berg van Thailand met uitzicht op Myanmar." },
            { id: 614, rank: 14, type: 'hike', tag: 'nature', region: 'north', name: "Tham Lod Cave Trek", lat: 19.5675, lng: 98.2783, price: "‚Ç¨ 12,00", desc: "Tocht door enorme grotten en bamboevlotvaren." },
            { id: 615, rank: 15, type: 'hike', tag: 'nature', region: 'north', name: "Doi Samer Dao", lat: 18.3697, lng: 100.4939, price: "‚Ç¨ 2,70", desc: "Bergkam in Nan, perfect voor sterrenkijken." },
            { id: 626, rank: 26, type: 'hike', tag: 'culture', region: 'north', name: "Wat Chalermprakiat", lat: 18.7414, lng: 99.5394, price: "‚Ç¨ 5,40", desc: "Klim naar witte pagodes op onmogelijke kalksteentoppen." },
            { id: 632, rank: 32, type: 'hike', tag: 'nature', region: 'north', name: "Sticky Waterfalls (Bua Tong)", lat: 19.0667, lng: 99.0833, price: "Gratis", desc: "Unieke kalksteenwatervallen waar je door de grip omhoog kunt klimmen." },
            { id: 651, rank: 51, type: 'hike', tag: 'nature', region: 'east', name: "Phu Kradueng Summit Hike", lat: 16.8833, lng: 101.7833, price: "‚Ç¨ 10,80", desc: "Legendarische, zware klim naar het tafelbergplateau." },
            { id: 653, rank: 53, type: 'hike', tag: 'nature', region: 'east', name: "Three Whale Rock", lat: 18.2575, lng: 103.8058, price: "Gratis", desc: "Wandelen over enorme zandsteenformaties die op walvissen lijken." },
            { id: 654, rank: 54, type: 'hike', tag: 'nature', region: 'east', name: "Sam Pan Bok", lat: 15.7950, lng: 105.3922, price: "Gratis", desc: "Verkenning van 3000 gaten in de droge bedding van de Mekong." },
            { id: 701, rank: 101, type: 'hike', tag: 'nature', region: 'west', name: "Erawan Waterfalls (Tier 7)", lat: 14.3683, lng: 99.1439, price: "‚Ç¨ 8,10", desc: "Wandeling naar de top van de 7-traps smaragdgroene waterval." },
            { id: 702, rank: 102, type: 'hike', tag: 'nature', region: 'west', name: "Khao Chang Phueak", lat: 14.7000, lng: 98.6000, price: "‚Ç¨ 5,40", desc: "Knife Edge bergkamwandeling; gevaarlijk en exclusief." },
            { id: 707, rank: 107, type: 'hike', tag: 'nature', region: 'south', name: "Phraya Nakhon Cave", lat: 12.2000, lng: 100.0167, price: "‚Ç¨ 5,40", desc: "Klim naar een grot met een koninklijk paviljoen." },
            { id: 751, rank: 151, type: 'hike', tag: 'nature', region: 'south', name: "Dragon Crest (Khao Ngon Nak)", lat: 8.0833, lng: 98.7667, price: "‚Ç¨ 5,40", desc: "Zware klim naar een iconisch uitkijkpunt over de Andamanse Zee." },
            { id: 754, rank: 154, type: 'hike', tag: 'culture', region: 'south', name: "Tiger Cave Temple (Summit)", lat: 8.1242, lng: 98.9247, price: "Gratis", desc: "1.260 treden naar een gouden chedi op een bergtop." },
            { id: 757, rank: 157, type: 'hike', tag: 'nature', region: 'south', name: "Samet Nangshe Viewpoint", lat: 8.2333, lng: 98.4500, price: "‚Ç¨ 1,35", desc: "Steile wandeling naar uitzicht op de baai van Phang Nga." }
        ];

        let markers = [];

        // --- 4. RENDER FUNCTIE ---
        function renderMarkers() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            const maxRank = parseInt(document.getElementById('rankSlider').value);
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const showFavsOnly = document.getElementById('favFilter').checked;
            
            const catChecked = Array.from(document.querySelectorAll('input[name="cat"]:checked')).map(cb => cb.value);
            const regChecked = Array.from(document.querySelectorAll('input[name="reg"]:checked')).map(cb => cb.value);
            const tagChecked = Array.from(document.querySelectorAll('input[name="tag"]:checked')).map(cb => cb.value);
            const priceFilter = document.getElementById('priceFilter').value;

            // Bepaal huidige omrekenfactor (Standaard DB is gebaseerd op 100 THB = 2.70 EUR)
            const convertPrice = (priceStr) => {
                if (userRate === 0 || priceStr.toLowerCase().includes('gratis') || priceStr.toLowerCase().includes('donatie')) return priceStr;
                let amount = parseFloat(priceStr.replace(/[^0-9,.]/g, '').replace(',', '.'));
                if (!amount) return priceStr;
                let estimatedTHB = (amount / 2.70) * 100; // Terug naar THB
                let newEur = (estimatedTHB / 100) * userRate; // Naar User EUR
                return `‚Ç¨ ${newEur.toFixed(2)}`;
            };

            locations.forEach(loc => {
                if (loc.lat < 5 || loc.lat > 21) return; // Geofence Thailand
                
                // Filters
                if (showFavsOnly && !favorites.includes(loc.id)) return;
                if (!showFavsOnly && loc.rank > maxRank) return;
                if (searchTerm && !loc.name.toLowerCase().includes(searchTerm)) return;
                if (!catChecked.includes(loc.type)) return;
                if (!regChecked.includes(loc.region)) return;
                if (!tagChecked.includes(loc.tag)) return;

                // Prijs Filter Logica
                if (priceFilter !== 'all') {
                    if (priceFilter === 'free' && !loc.price.toLowerCase().includes('gratis')) return;
                    const isCheap = loc.price.includes('‚Ç¨ 1') || loc.price.includes('‚Ç¨ 2') || loc.price.includes('‚Ç¨ 3') || loc.price.includes('‚Ç¨ 4');
                    const isMid = !isCheap && (parseInt(loc.price.replace(/[^0-9]/g, '')) < 20);
                    if (priceFilter === 'cheap' && !isCheap && !loc.price.toLowerCase().includes('gratis')) return;
                    if (priceFilter === 'mid' && !isMid) return;
                    if (priceFilter === 'high' && (isCheap || isMid || loc.price.toLowerCase().includes('gratis'))) return;
                }

                // Icon & Kleur
                let iconChar = '';
                if(loc.type === 'sight') iconChar = 'üì∑';
                if(loc.type === 'food') iconChar = 'üçú';
                if(loc.type === 'activity') iconChar = 'üèÑ';
                if(loc.type === 'hike') iconChar = 'ü•æ';
                
                const cssClass = `marker-${loc.type}`;
                
                const customIcon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div class="custom-pin ${cssClass}">
                            <div class="pin-icon">${iconChar}</div>
                            <div class="rank-badge">${loc.rank}</div>
                           </div>`,
                    iconSize: [40, 40],
                    iconAnchor: [20, 40],
                    popupAnchor: [0, -45]
                });

                const marker = L.marker([loc.lat, loc.lng], { icon: customIcon }).addTo(map);
                
                // Afstand
                let distHtml = '';
                if(userLat) {
                    const d = getDistanceFromLatLonInKm(userLat, userLng, loc.lat, loc.lng);
                    distHtml = `<span class="distance-tag">üìè ${d.toFixed(1)} km</span>`;
                }

                // Favoriet Icoon
                const isFav = favorites.includes(loc.id);
                const favIcon = isFav ? '‚ù§Ô∏è' : 'ü§ç';
                const favClass = isFav ? 'fav-active' : 'fav-inactive';

                // Prijs berekenen
                const displayPrice = convertPrice(loc.price);
                const priceColor = displayPrice.includes('Gratis') ? 'green' : '#333';

                // Links
                // Gebruik Google Maps SEARCH query voor betere mobiele ervaring (opent app met pin)
                const navUrl = `https://www.google.com/maps/search/?api=1&query=${loc.lat},${loc.lng}`;
                const infoUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc.name + " Thailand")}`; 
                const ytUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(loc.name + ' Thailand vlog')}`;
                const wikiUrl = `https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(loc.name)}`;

                const popupHtml = `
                    <div class="popup-content">
                        <div class="popup-header">
                            <div>
                                <div class="category-tag">${loc.type} ‚Ä¢ #${loc.rank}</div>
                                <h3>${loc.name}</h3>
                            </div>
                            <button id="fav-btn-${loc.id}" class="fav-btn ${favClass}" onclick="toggleFav(${loc.id})">${favIcon}</button>
                        </div>
                        ${distHtml}
                        <div class="desc">${loc.desc}</div>
                        
                        <div class="meta-row">
                            <span>üìç ${loc.region.charAt(0).toUpperCase() + loc.region.slice(1)}</span>
                            <span style="color:${priceColor}">${displayPrice}</span>
                        </div>

                        <div class="btn-grid">
                            <a href="${navUrl}" target="_blank" class="popup-btn btn-nav">üöó Navigeer</a>
                            <a href="${infoUrl}" target="_blank" class="popup-btn btn-google">‚≠ê Reviews</a>
                            <a href="${ytUrl}" target="_blank" class="popup-btn btn-yt">‚ñ∂ YouTube</a>
                            <a href="${wikiUrl}" target="_blank" class="popup-btn btn-wiki">üìñ Wiki</a>
                        </div>
                    </div>
                `;

                marker.bindPopup(popupHtml);
                markers.push(marker);
            });
        }

        // --- 5. HELPERS ---
        function updateSliderVal() { document.getElementById('rankVal').innerText = document.getElementById('rankSlider').value; }
        
        function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
            var R = 6371; var dLat = deg2rad(lat2-lat1); var dLon = deg2rad(lon2-lon1); 
            var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            return R * c; 
        }
        function deg2rad(deg) { return deg * (Math.PI/180); }

        function locateUser() {
            const s = document.getElementById('user-status');
            if(!navigator.geolocation) { s.innerText = "Geen GPS"; return; }
            s.innerText = "Zoeken...";
            navigator.geolocation.getCurrentPosition(p => {
                userLat = p.coords.latitude; userLng = p.coords.longitude;
                map.eachLayer(l => { if(l.options.title === 'user') map.removeLayer(l); });
                L.marker([userLat, userLng], {title:'user'}).addTo(map).bindPopup("Jij").openPopup();
                map.setView([userLat, userLng], 10);
                s.innerText = "Gevonden!";
                renderMarkers();
            }, () => { s.innerText = "Fout bij locatie."; });
        }

        // Event Listeners
        document.getElementById('rankSlider').addEventListener('input', (e) => {
            document.getElementById('rankVal').innerText = e.target.value;
            renderMarkers();
        });
        document.getElementById('searchInput').addEventListener('input', renderMarkers);
        // Sluit menu bij klik op kaart (optioneel, maar handig op mobiel)
        map.on('click', () => { if(isMobile) document.getElementById('controls').classList.remove('active'); });

        renderMarkers();

    </script>
</body>
</html>
