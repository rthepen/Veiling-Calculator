<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thailand Ultimate Guide v11</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* --- STYLING --- */
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; overflow: hidden; background: #f0f0f0; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        /* Knop Filters */
        #toggle-btn {
            position: absolute; top: 15px; right: 15px;
            background: #fff; color: #333;
            padding: 10px 16px; border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000; border: none;
            font-weight: 700; font-size: 14px;
            cursor: pointer; display: flex; align-items: center; gap: 6px;
            transition: transform 0.2s;
        }
        #toggle-btn:active { transform: scale(0.95); }

        /* Sidebar */
        #controls {
            position: absolute; top: 0; right: 0;
            height: 100vh; width: 350px;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: -5px 0 25px rgba(0,0,0,0.2);
            z-index: 2000;
            display: flex; flex-direction: column;
            transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #controls.active { transform: translateX(0); }

        @media (max-width: 600px) { #controls { width: 100%; max-width: 100%; } }

        .sidebar-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }
        .sidebar-footer { padding: 15px 20px; border-top: 1px solid #eee; background: #fff; }

        h2 { margin: 0; font-size: 18px; color: #222; }
        h4 { margin: 20px 0 10px 0; font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; font-weight: 800; border-bottom: 1px solid #f0f0f0; padding-bottom: 5px; }
        .close-btn { background: none; border: none; font-size: 28px; color: #555; padding: 0 10px; cursor: pointer; }

        /* Calculator */
        .calc-box { background: #eef5ff; padding: 15px; border-radius: 12px; border: 1px solid #d0e3ff; }
        .calc-row { display: flex; gap: 10px; margin-bottom: 5px; }
        .calc-input { flex: 1; }
        .calc-input label { display: block; font-size: 10px; font-weight: bold; color: #555; margin-bottom: 3px; }
        .calc-input input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        .rate-display { font-size: 13px; color: #0056b3; font-weight: bold; text-align: center; margin: 10px 0; }
        .purchase-result { font-size: 16px; font-weight: bold; color: #28a745; text-align: center; line-height: 34px; }

        /* Inputs */
        #searchInput { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ddd; background: #f9f9f9; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; }
        .filter-group label { display: flex; align-items: center; margin-bottom: 12px; cursor: pointer; font-size: 15px; color: #333; }
        input[type="checkbox"] { width: 20px; height: 20px; margin-right: 12px; accent-color: #007bff; border-radius: 4px; }
        input[type=range] { width: 100%; margin: 10px 0; accent-color: #007bff; }
        select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; background: #f9f9f9; font-size: 14px; }
        
        /* Pins */
        .custom-pin {
            border-radius: 50% 50% 50% 0; border: 3px solid #fff; width: 40px; height: 40px;
            transform: rotate(-45deg); display: flex !important; align-items: center; justify-content: center;
            box-shadow: 2px 2px 6px rgba(0,0,0,0.3); position: relative; transition: transform 0.2s;
        }
        .pin-icon { transform: rotate(45deg); font-size: 18px; line-height: 1; }
        .rank-badge {
            position: absolute; top: -6px; right: -6px; background: #fff; color: #000; border: 2px solid #333;
            border-radius: 50%; width: 18px; height: 18px; font-size: 10px; font-weight: 900;
            display: flex; align-items: center; justify-content: center; transform: rotate(45deg); z-index: 10;
        }
        
        .marker-sight { background-color: #007bff; }
        .marker-food { background-color: #dc3545; }
        .marker-activity { background-color: #9c27b0; }
        .marker-hike { background-color: #28a745; }
        .legend-color { display: inline-block; width: 14px; height: 14px; border-radius: 50%; margin-right: 8px; flex-shrink: 0; }
        .c-sight { background-color: #007bff; } .c-food { background-color: #dc3545; } .c-act { background-color: #9c27b0; } .c-hike { background-color: #28a745; }

        /* Popup */
        .leaflet-popup-content-wrapper { border-radius: 12px; }
        .popup-content { min-width: 260px; padding-bottom: 5px; }
        .popup-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 5px; }
        .popup-header h3 { margin: 0; font-size: 16px; color: #222; width: 85%; }
        .fav-btn { cursor: pointer; font-size: 20px; background: none; border: none; padding: 0; line-height: 1; transition: transform 0.2s; }
        .fav-btn:active { transform: scale(1.3); }
        .fav-active { color: red; } .fav-inactive { color: #ccc; }
        .desc { font-size: 13px; color: #555; margin-bottom: 10px; line-height: 1.4; }
        .meta-row { display: flex; justify-content: space-between; align-items: center; background: #f9f9f9; padding: 8px; border-radius: 6px; margin-bottom: 10px; font-size: 12px; font-weight: 600; }
        .distance-tag { display: block; font-size: 11px; color: #666; margin-top: 4px; font-weight: normal; }

        /* Knoppen */
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .full-width { grid-column: 1 / -1; }
        .popup-btn { display: flex; align-items: center; justify-content: center; text-decoration: none; border-radius: 6px; padding: 10px; font-size: 12px; font-weight: bold; color: white; gap: 6px; transition: opacity 0.2s; }
        .popup-btn:hover { opacity: 0.9; }
        .btn-google { background: #4285F4; } .btn-nav { background: #34A853; } .btn-yt { background: #FF0000; } .btn-wiki { background: #555; }
        
        .loc-btn { width: 100%; padding: 14px; background: #222; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>

    <button id="toggle-btn" onclick="toggleMenu()">‚öôÔ∏è Filters & Tools</button>

    <div id="controls">
        <div class="sidebar-header">
            <h2>üáπüá≠ Thai Ultimate Guide</h2>
            <button class="close-btn" onclick="toggleMenu()">√ó</button>
        </div>

        <div class="sidebar-content">
            <input type="text" id="searchInput" placeholder="üîç Zoek op naam..." onkeyup="renderMarkers()">

            <h4>üßÆ Wisselkoers & Aankoop</h4>
            <div class="calc-box">
                <div class="calc-row">
                    <div class="calc-input">
                        <label>Gepind (THB)</label>
                        <input type="number" id="calcTHB" placeholder="10000" oninput="calculateRate()">
                    </div>
                    <div class="calc-input">
                        <label>Afgeschreven (‚Ç¨)</label>
                        <input type="number" id="calcEUR" placeholder="275" oninput="calculateRate()">
                    </div>
                </div>
                <div id="rateResult" class="rate-display">Koers: 100 THB = ‚Ç¨ 2.70</div>
                
                <div style="border-top: 1px solid #ccc; margin-top: 10px; padding-top: 10px;">
                    <label style="font-size: 12px; font-weight: bold; color: #333;">Wat kost het? (Aankoop)</label>
                    <div class="calc-row">
                        <div class="calc-input">
                            <input type="number" id="purchaseTHB" placeholder="Prijs in THB" oninput="calcPurchase()">
                        </div>
                        <div class="calc-input" style="background: #fff; border: 1px solid #ccc; border-radius: 6px;">
                            <div id="purchaseResult" class="purchase-result">‚Ç¨ 0.00</div>
                        </div>
                    </div>
                </div>
            </div>

            <h4>‚ù§Ô∏è Jouw Reis</h4>
            <div class="filter-group">
                <label><input type="checkbox" id="favFilter" onchange="renderMarkers()"> Toon alleen Favorieten</label>
            </div>

            <h4>üèÜ Toplijst (1-200)</h4>
            <div style="display:flex; justify-content:space-between; font-weight:bold; color:#007bff; margin-bottom:5px;">
                <span>Top</span><span id="rankVal">200</span>
            </div>
            <input type="range" id="rankSlider" min="1" max="200" value="200" oninput="updateSliderVal(); renderMarkers()">

            <h4>Categorie√´n</h4>
            <div class="filter-group">
                <label><input type="checkbox" name="cat" value="sight" checked onchange="renderMarkers()"> <span class="legend-color c-sight"></span> Bezienswaardigheden</label>
                <label><input type="checkbox" name="cat" value="food" checked onchange="renderMarkers()"> <span class="legend-color c-food"></span> Eten & Drinken</label>
                <label><input type="checkbox" name="cat" value="activity" checked onchange="renderMarkers()"> <span class="legend-color c-act"></span> Activiteiten</label>
                <label><input type="checkbox" name="cat" value="hike" checked onchange="renderMarkers()"> <span class="legend-color c-hike"></span> Wandelingen</label>
            </div>

            <h4>Type Ervaring</h4>
            <div class="filter-group">
                <label><input type="checkbox" name="tag" value="nature" checked onchange="renderMarkers()"> üå≥ Natuur</label>
                <label><input type="checkbox" name="tag" value="culture" checked onchange="renderMarkers()"> üèõÔ∏è Cultuur & Stad</label>
            </div>

            <h4>Regio's</h4>
            <div class="filter-group">
                <label><input type="checkbox" name="reg" value="bangkok" checked onchange="renderMarkers()"> Centraal & Bangkok</label>
                <label><input type="checkbox" name="reg" value="north" checked onchange="renderMarkers()"> Noord (Chiang Mai)</label>
                <label><input type="checkbox" name="reg" value="south" checked onchange="renderMarkers()"> Zuid (Eilanden)</label>
                <label><input type="checkbox" name="reg" value="west" checked onchange="renderMarkers()"> West (Kanchanaburi)</label>
                <label><input type="checkbox" name="reg" value="east" checked onchange="renderMarkers()"> Oost (Pattaya/Isaan)</label>
            </div>

            <h4>Prijsklasse</h4>
            <select id="priceFilter" onchange="renderMarkers()">
                <option value="all">Alle prijzen</option>
                <option value="free">Gratis</option>
                <option value="cheap">Budget (< ‚Ç¨5)</option>
                <option value="mid">Gemiddeld (‚Ç¨5 - ‚Ç¨20)</option>
                <option value="high">Luxe (> ‚Ç¨20)</option>
            </select>
        </div>

        <div class="sidebar-footer">
            <button class="loc-btn" onclick="locateUser()">üìç Mijn Locatie</button>
            <div id="user-status" style="font-size: 11px; margin-top: 5px; color: #666; text-align: center;"></div>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- 1. DE DATABASE (Nu Intern) ---
        const locations = [
            // SIGHTS (101-200)
            { id: 101, rank: 1, type: 'sight', tag: 'culture', region: 'bangkok', name: "The Grand Palace", lat: 13.7500, lng: 100.4915, price: "‚Ç¨ 13,50", desc: "Het offici√´le verblijf van de koningen van Siam." },
            { id: 102, rank: 2, type: 'sight', tag: 'culture', region: 'bangkok', name: "Wat Arun", lat: 13.7437, lng: 100.4888, price: "‚Ç¨ 5,40", desc: "Tempel van de Dageraad, iconisch om zijn centrale toren." },
            { id: 103, rank: 3, type: 'sight', tag: 'culture', region: 'bangkok', name: "Wat Pho", lat: 13.7465, lng: 100.4933, price: "‚Ç¨ 8,10", desc: "Huis van de liggende Boeddha en de eerste universiteit." },
            { id: 104, rank: 4, type: 'sight', tag: 'culture', region: 'bangkok', name: "Chatuchak Weekend Market", lat: 13.7998, lng: 100.5504, price: "Gratis", desc: "Grootste markt ter wereld met 15.000 kraampjes." },
            { id: 105, rank: 5, type: 'sight', tag: 'culture', region: 'bangkok', name: "Ayutthaya Historical Park", lat: 14.3532, lng: 100.5684, price: "‚Ç¨ 1,35", desc: "De oude hoofdstad, UNESCO werelderfgoed." },
            { id: 106, rank: 6, type: 'sight', tag: 'nature', region: 'south', name: "Khao Sok National Park", lat: 8.9135, lng: 98.5309, price: "‚Ç¨ 8,10", desc: "Oerwoud ouder dan de Amazone en drijvende huisjes." },
            { id: 107, rank: 7, type: 'sight', tag: 'culture', region: 'bangkok', name: "Damnoen Saduak Market", lat: 13.5195, lng: 99.9577, price: "Gratis", desc: "De beroemdste drijvende markt van Thailand." },
            { id: 108, rank: 8, type: 'sight', tag: 'culture', region: 'bangkok', name: "Chinatown (Yaowarat)", lat: 13.7410, lng: 100.5085, price: "Gratis", desc: "Bruisend hart van streetfood en handel." },
            { id: 109, rank: 9, type: 'sight', tag: 'nature', region: 'west', name: "Erawan National Park", lat: 14.3755, lng: 99.1440, price: "‚Ç¨ 8,10", desc: "Sprookjesachtige waterval met zeven niveaus." },
            { id: 110, rank: 10, type: 'sight', tag: 'nature', region: 'south', name: "Railay Beach", lat: 8.0110, lng: 98.8373, price: "Gratis", desc: "Kalksteenkliffen en stranden, alleen per boot bereikbaar." },
            { id: 111, rank: 11, type: 'sight', tag: 'culture', region: 'north', name: "Wat Phra That Doi Suthep", lat: 18.8048, lng: 98.9216, price: "‚Ç¨ 0,80", desc: "Gouden tempel op een bergtop boven Chiang Mai." },
            { id: 112, rank: 12, type: 'sight', tag: 'culture', region: 'north', name: "Wat Rong Khun (Witte Tempel)", lat: 19.8243, lng: 99.7632, price: "‚Ç¨ 2,70", desc: "Moderne kunsttempel, overgang van hel naar hemel." },
            { id: 113, rank: 13, type: 'sight', tag: 'culture', region: 'north', name: "Sukhothai Historical Park", lat: 17.0163, lng: 99.7036, price: "‚Ç¨ 2,70", desc: "De eerste hoofdstad van Siam met elegante Boeddha's." },
            { id: 114, rank: 14, type: 'sight', tag: 'nature', region: 'south', name: "Phang Nga Bay", lat: 8.2855, lng: 98.5093, price: "‚Ç¨ 8,10", desc: "Baai vol iconische kalksteenrotsen die uit zee rijzen." },
            { id: 115, rank: 15, type: 'sight', tag: 'culture', region: 'bangkok', name: "Jim Thompson House", lat: 13.7495, lng: 100.5283, price: "‚Ç¨ 5,40", desc: "Teakhouten huis van de man die Thaise zijde beroemd maakte." },
            { id: 116, rank: 16, type: 'sight', tag: 'nature', region: 'south', name: "Koh Phi Phi (Maya Bay)", lat: 7.6775, lng: 98.7663, price: "‚Ç¨ 10,80", desc: "Beroemdste strand van Thailand, bekend van 'The Beach'." },
            { id: 117, rank: 17, type: 'sight', tag: 'nature', region: 'east', name: "Koh Samet", lat: 12.5683, lng: 101.4526, price: "‚Ç¨ 5,40", desc: "Witte stranden op reisafstand van Bangkok." },
            { id: 118, rank: 18, type: 'sight', tag: 'culture', region: 'east', name: "Sanctuary of Truth", lat: 12.9727, lng: 100.8891, price: "‚Ç¨ 13,50", desc: "Gigantisch houten monument aan zee, volledig handgesneden." },
            { id: 119, rank: 19, type: 'sight', tag: 'culture', region: 'bangkok', name: "Asiatique The Riverfront", lat: 13.7045, lng: 100.5034, price: "Gratis", desc: "Shoppen en dineren aan de rivier in oude pakhuizen." },
            { id: 120, rank: 20, type: 'sight', tag: 'nature', region: 'north', name: "Doi Inthanon", lat: 18.5886, lng: 98.4862, price: "‚Ç¨ 8,10", desc: "Het hoogste punt van Thailand met nevelwouden." },
            { id: 123, rank: 23, type: 'sight', tag: 'nature', region: 'north', name: "Elephant Nature Park", lat: 19.2155, lng: 98.8606, price: "‚Ç¨ 67,50", desc: "Pionier in ethische olifantenopvang in Chiang Mai." },
            { id: 125, rank: 25, type: 'sight', tag: 'culture', region: 'west', name: "Dragon Descendants Museum", lat: 14.4776, lng: 100.1106, price: "‚Ç¨ 13,00", desc: "Enorm drakenmuseum over de Chinees-Thaise geschiedenis." },
            { id: 127, rank: 27, type: 'sight', tag: 'nature', region: 'east', name: "Koh Larn", lat: 12.9213, lng: 100.7776, price: "Gratis", desc: "Koraaleiland met helder water voor de kust van Pattaya." },
            { id: 128, rank: 28, type: 'sight', tag: 'nature', region: 'east', name: "Koh Chang", lat: 12.0406, lng: 102.3023, price: "Gratis", desc: "Groot, bergachtig eiland met jungle en stranden." },
            { id: 130, rank: 30, type: 'sight', tag: 'culture', region: 'north', name: "Chiang Mai Night Bazaar", lat: 18.7856, lng: 99.0003, price: "Gratis", desc: "Beroemde avondmarkt voor souvenirs en handwerk." },
            { id: 134, rank: 34, type: 'sight', tag: 'culture', region: 'north', name: "Wat Chedi Luang", lat: 18.7870, lng: 98.9866, price: "‚Ç¨ 1,10", desc: "Grote ru√Øne-stoepa in het centrum van Chiang Mai." },
            { id: 138, rank: 38, type: 'sight', tag: 'nature', region: 'north', name: "Pai Canyon", lat: 19.3060, lng: 98.4526, price: "Gratis", desc: "Smalle zandsteenruggen en diepe afgronden bij zonsondergang." },
            { id: 139, rank: 39, type: 'sight', tag: 'culture', region: 'west', name: "Wat Tham Suea", lat: 13.9535, lng: 99.6053, price: "Gratis", desc: "Enorme Boeddha met uitzicht over de rijstvelden." },
            { id: 141, rank: 41, type: 'sight', tag: 'culture', region: 'bangkok', name: "Maeklong Railway Market", lat: 13.4075, lng: 99.9987, price: "Gratis", desc: "De markt waar de trein dwars doorheen rijdt." },
            { id: 143, rank: 43, type: 'sight', tag: 'culture', region: 'north', name: "Wat Chaloem Phra Kiat", lat: 18.7413, lng: 99.5436, price: "‚Ç¨ 5,40", desc: "Zwevende pagodes op messcherpe kalksteenpieken." },
            { id: 144, rank: 44, type: 'sight', tag: 'nature', region: 'south', name: "James Bond Island", lat: 8.2750, lng: 98.5000, price: "‚Ç¨ 8,10", desc: "De beroemde rots uit 'The Man with the Golden Gun'." },
            { id: 147, rank: 47, type: 'sight', tag: 'culture', region: 'south', name: "Big Buddha Phuket", lat: 7.8276, lng: 98.3126, price: "Gratis", desc: "Enorm wit marmeren beeld op een heuveltop." },
            { id: 148, rank: 48, type: 'sight', tag: 'nature', region: 'east', name: "Nong Nooch Tropical Garden", lat: 12.7663, lng: 100.9335, price: "‚Ç¨ 13,50", desc: "Prachtig aangelegde botanische tuinen in Pattaya." },
            { id: 150, rank: 50, type: 'sight', tag: 'culture', region: 'bangkok', name: "MOCA Bangkok", lat: 13.8523, lng: 100.5627, price: "‚Ç¨ 6,75", desc: "Indrukwekkende collectie moderne Thaise kunst." },
            { id: 151, rank: 51, type: 'sight', tag: 'culture', region: 'east', name: "Phanom Rung Historical Park", lat: 14.5323, lng: 102.9426, price: "‚Ç¨ 2,70", desc: "Khmer-tempel op de rand van een uitgedoofde vulkaan." },
            { id: 153, rank: 53, type: 'sight', tag: 'nature', region: 'east', name: "Sam Pan Bok", lat: 15.8033, lng: 105.3855, price: "Gratis", desc: "De 'Grand Canyon' van Thailand in de Mekong-rivier." },
            { id: 155, rank: 55, type: 'sight', tag: 'culture', region: 'east', name: "Wat Phu Tok", lat: 18.1319, lng: 103.8827, price: "Gratis", desc: "Tempel met houten loopbruggen rondom een eenzame rots." },
            { id: 172, rank: 72, type: 'sight', tag: 'culture', region: 'west', name: "Bridge Over the River Kwai", lat: 14.0410, lng: 99.5042, price: "Gratis", desc: "De beruchte brug uit de Tweede Wereldoorlog." },
            { id: 173, rank: 73, type: 'sight', tag: 'culture', region: 'west', name: "Hellfire Pass", lat: 14.3528, lng: 98.9536, price: "Gratis", desc: "Wandelroute door de uitgehakte rotskloof van de spoorlijn." },
            { id: 181, rank: 81, type: 'sight', tag: 'nature', region: 'south', name: "Phi Phi Islands (Maya Bay)", lat: 7.6775, lng: 98.7663, price: "‚Ç¨ 10,80", desc: "Wereldberoemde baai, nu ecologisch herstellende." },
            { id: 183, rank: 83, type: 'sight', tag: 'nature', region: 'south', name: "Samet Nangshe Viewpoint", lat: 8.2406, lng: 98.4485, price: "‚Ç¨ 0,80", desc: "Het ultieme uitzicht over de baai van Phang Nga." },
            { id: 185, rank: 85, type: 'sight', tag: 'nature', region: 'south', name: "Similan Islands", lat: 8.6536, lng: 97.6433, price: "‚Ç¨ 13,50", desc: "Wereldklasse duik- en snorkelplek (gesloten mei-okt)." },
            { id: 187, rank: 87, type: 'sight', tag: 'nature', region: 'south', name: "Koh Lipe", lat: 6.4884, lng: 99.3039, price: "‚Ç¨ 5,40", desc: "De 'Malediven van Thailand' met turquoise water." },
            { id: 188, rank: 88, type: 'sight', tag: 'nature', region: 'south', name: "Koh Tao", lat: 10.0956, lng: 99.8404, price: "Gratis", desc: "Het eiland om te leren duiken." },
            { id: 189, rank: 89, type: 'sight', tag: 'nature', region: 'south', name: "Ang Thong National Marine Park", lat: 9.6150, lng: 99.6766, price: "‚Ç¨ 8,10", desc: "Archipel van 42 eilanden, bekend van 'The Beach'." },
            { id: 194, rank: 94, type: 'sight', tag: 'nature', region: 'south', name: "Aiyerweng Skywalk", lat: 5.9757, lng: 101.1825, price: "‚Ç¨ 5,40", desc: "Glazen platform met uitzicht over de 'Zee van Mist' in Betong." },
            { id: 195, rank: 95, type: 'sight', tag: 'culture', region: 'south', name: "Phuket Old Town", lat: 7.8858, lng: 98.3907, price: "Gratis", desc: "Kleurrijke Sino-Portugese architectuur." },

            // FOOD (201-250)
            { id: 201, rank: 1, type: 'food', tag: 'culture', region: 'bangkok', name: "Raan Jay Fai", lat: 13.7525, lng: 100.5048, price: "‚Ç¨ 35,00", desc: "Michelin streetfood icoon." },
            { id: 202, rank: 2, type: 'food', tag: 'culture', region: 'bangkok', name: "Wattana Panich", lat: 13.7341, lng: 100.5876, price: "‚Ç¨ 4,00", desc: "Eeuwige rundvleessoep." },
            { id: 203, rank: 3, type: 'food', tag: 'culture', region: 'bangkok', name: "Guay Jub Ouan Pochana", lat: 13.7408, lng: 100.5094, price: "‚Ç¨ 2,50", desc: "Peperige noedelsoep met krokante varkensbuik." },
            { id: 204, rank: 4, type: 'food', tag: 'culture', region: 'bangkok', name: "Khao Gaeng Jek Pui", lat: 13.7435, lng: 100.5097, price: "‚Ç¨ 2,00", desc: "Curry eten op rode krukjes zonder tafels." },
            { id: 205, rank: 5, type: 'food', tag: 'culture', region: 'bangkok', name: "T&K Seafood", lat: 13.7410, lng: 100.5085, price: "‚Ç¨ 10,00", desc: "Beste seafood op straat." },
            { id: 206, rank: 6, type: 'food', tag: 'culture', region: 'bangkok', name: "Lim Lao Ngow", lat: 13.7377, lng: 100.5117, price: "‚Ç¨ 2,50", desc: "Beroemde verende visballetjes." },
            { id: 207, rank: 7, type: 'food', tag: 'culture', region: 'bangkok', name: "Jok Prince", lat: 13.7196, lng: 100.5153, price: "‚Ç¨ 1,50", desc: "Rijstepap met een rokerige smaak." },
            { id: 208, rank: 8, type: 'food', tag: 'culture', region: 'bangkok', name: "Nai Mong Hoi Tod", lat: 13.7413, lng: 100.5099, price: "‚Ç¨ 4,00", desc: "De beste oesteromelet van de stad." },
            { id: 209, rank: 9, type: 'food', tag: 'culture', region: 'bangkok', name: "Kor Panich", lat: 13.7533, lng: 100.4996, price: "‚Ç¨ 3,00", desc: "Legendarische Mango Sticky Rice." },
            { id: 210, rank: 10, type: 'food', tag: 'culture', region: 'bangkok', name: "Somsak Pu Ob", lat: 13.7224, lng: 100.4965, price: "‚Ç¨ 8,50", desc: "Glasnoedels met krab uit een aarden pot." },
            { id: 213, rank: 13, type: 'food', tag: 'culture', region: 'bangkok', name: "Jeh O Chula", lat: 13.7425, lng: 100.5225, price: "‚Ç¨ 7,00", desc: "Tom Yum Mama noedels 's nachts." },
            { id: 221, rank: 21, type: 'food', tag: 'culture', region: 'bangkok', name: "Sorn", lat: 13.7268, lng: 100.5698, price: "‚Ç¨ 150,00", desc: "2-sterren Zuid-Thaise fine dining." },
            { id: 223, rank: 38, type: 'food', tag: 'culture', region: 'bangkok', name: "Here Hai", lat: 13.7346, lng: 100.5833, price: "‚Ç¨ 12,00", desc: "Gebakken rijst met waanzinnig veel krab." },
            { id: 224, rank: 50, type: 'food', tag: 'culture', region: 'bangkok', name: "Krua Apsorn", lat: 13.7578, lng: 100.5037, price: "‚Ç¨ 8,00", desc: "Krabomelet favoriet bij de koninklijke familie." },
            { id: 227, rank: 76, type: 'food', tag: 'culture', region: 'bangkok', name: "Ruan Thai Kung Pao", lat: 14.2882, lng: 100.5898, price: "‚Ç¨ 25,00", desc: "Gigantische riviergarnalen in Ayutthaya." },
            { id: 231, rank: 97, type: 'food', tag: 'culture', region: 'north', name: "Khao Soi Khun Yai", lat: 18.7953, lng: 98.9831, price: "‚Ç¨ 1,50", desc: "Oma's Khao Soi, alleen lunch." },
            { id: 242, rank: 171, type: 'food', tag: 'culture', region: 'south', name: "Raya Restaurant", lat: 7.8858, lng: 98.3909, price: "‚Ç¨ 15,00", desc: "Krabcurry Phuket." },

            // ACTIVITY (301-350)
            { id: 301, rank: 1, type: 'activity', tag: 'culture', region: 'bangkok', name: "Thaise Massage (Wat Pho)", lat: 13.7460, lng: 100.4930, price: "‚Ç¨ 12,00", desc: "De bakermat van de traditionele massage." },
            { id: 302, rank: 2, type: 'activity', tag: 'nature', region: 'north', name: "Elephant Nature Park", lat: 19.2155, lng: 98.8606, price: "‚Ç¨ 67,50", desc: "Pionier in ethische olifantenopvang." },
            { id: 303, rank: 3, type: 'activity', tag: 'culture', region: 'north', name: "Monk Chat (Chiang Mai)", lat: 18.7883, lng: 98.9853, price: "Gratis", desc: "Praat met monniken over het leven." },
            { id: 304, rank: 4, type: 'activity', tag: 'culture', region: 'bangkok', name: "Muay Thai Training", lat: 13.7607, lng: 100.5085, price: "‚Ç¨ 25,00", desc: "Train de nationale vechtsport." },
            { id: 305, rank: 5, type: 'activity', tag: 'culture', region: 'bangkok', name: "Kookcursus (Blue Elephant)", lat: 13.7196, lng: 100.5161, price: "‚Ç¨ 75,00", desc: "High-end kookschool met marktbezoek." },
            { id: 306, rank: 6, type: 'activity', tag: 'nature', region: 'south', name: "Duiken (Koh Tao)", lat: 10.0956, lng: 99.8404, price: "‚Ç¨ 80,00", desc: "Haal je PADI." },
            { id: 307, rank: 7, type: 'activity', tag: 'nature', region: 'south', name: "Gibbon Rehabilitation Project", lat: 8.0366, lng: 98.3644, price: "Donatie", desc: "Bezoek gerehabiliteerde gibbons." },
            { id: 310, rank: 10, type: 'activity', tag: 'nature', region: 'south', name: "Zeekajakken Phang Nga", lat: 8.2747, lng: 98.5012, price: "‚Ç¨ 35,00", desc: "Verken grotten en lagunes per kano." },
            { id: 314, rank: 14, type: 'activity', tag: 'culture', region: 'south', name: "Full Moon Party", lat: 9.6766, lng: 100.0631, price: "‚Ç¨ 5,40", desc: "Beroemdste strandfeest ter wereld." },
            { id: 315, rank: 15, type: 'activity', tag: 'culture', region: 'north', name: "Vipassana Meditatie", lat: 18.7756, lng: 98.9503, price: "Donatie", desc: "Intensieve meditatiecursus." },
            { id: 320, rank: 20, type: 'activity', tag: 'nature', region: 'west', name: "Bamboe Raften", lat: 14.1500, lng: 99.4000, price: "‚Ç¨ 15,00", desc: "Zak de rivier af op een vlot." },
            { id: 328, rank: 28, type: 'activity', tag: 'culture', region: 'bangkok', name: "Sak Yant Tattoo", lat: 13.9168, lng: 100.2078, price: "Donatie", desc: "Heilige tatoeage door monniken." },
            { id: 330, rank: 30, type: 'activity', tag: 'culture', region: 'bangkok', name: "Chatuchak Market", lat: 13.7998, lng: 100.5504, price: "Gratis", desc: "Shoppen." },
            { id: 336, rank: 36, type: 'activity', tag: 'culture', region: 'bangkok', name: "Rooftop Bar", lat: 13.7224, lng: 100.5800, price: "‚Ç¨ 15,00", desc: "Cocktails met uitzicht." },
            { id: 340, rank: 40, type: 'activity', tag: 'nature', region: 'bangkok', name: "Varanen Spotten", lat: 13.7314, lng: 100.5414, price: "Gratis", desc: "Zoek hagedissen in Lumpini Park." },
            { id: 350, rank: 50, type: 'activity', tag: 'culture', region: 'bangkok', name: "Muang Boran Fietsen", lat: 13.5390, lng: 100.6226, price: "‚Ç¨ 20,00", desc: "Fiets door 'The Ancient City'." },

            // HIKES (601-650+)
            { id: 601, rank: 1, type: 'hike', tag: 'nature', region: 'north', name: "Kew Mae Pan Nature Trail", lat: 18.5559, lng: 98.4822, price: "‚Ç¨ 13,50", desc: "Spectaculair pad langs de bergkam op de hoogste top van Thailand." },
            { id: 602, rank: 2, type: 'hike', tag: 'nature', region: 'north', name: "Ang Ka Nature Trail", lat: 18.5886, lng: 98.4862, price: "Gratis", desc: "Vlonderpad door een oeroud mosbos." },
            { id: 603, rank: 3, type: 'hike', tag: 'nature', region: 'north', name: "Doi Luang Chiang Dao", lat: 19.3975, lng: 98.8839, price: "‚Ç¨ 40,00", desc: "Zware kalksteenbeklimming." },
            { id: 604, rank: 4, type: 'hike', tag: 'nature', region: 'north', name: "Monk's Trail (Wat Pha Lat)", lat: 18.7993, lng: 98.9436, price: "Gratis", desc: "Pelgrimspad naar tempel." },
            { id: 605, rank: 5, type: 'hike', tag: 'nature', region: 'north', name: "Pha Dok Siew", lat: 18.5332, lng: 98.5333, price: "‚Ç¨ 5,40", desc: "Rijstterrassen en watervallen." },
            { id: 606, rank: 6, type: 'hike', tag: 'nature', region: 'north', name: "Phu Chi Fa", lat: 19.8506, lng: 100.4533, price: "Gratis", desc: "Zonsopgang op klifrand." },
            { id: 607, rank: 7, type: 'hike', tag: 'nature', region: 'north', name: "Pai Canyon", lat: 19.3067, lng: 98.4530, price: "Gratis", desc: "Smalle zandsteenruggen." },
            { id: 608, rank: 8, type: 'hike', tag: 'nature', region: 'north', name: "Doi Suthep Summit", lat: 18.8000, lng: 98.9000, price: "Gratis", desc: "Steile jungletocht." },
            { id: 609, rank: 9, type: 'hike', tag: 'nature', region: 'north', name: "Huay Tung Tao", lat: 18.8667, lng: 98.9333, price: "‚Ç¨ 1,35", desc: "Meer lus." },
            { id: 610, rank: 10, type: 'hike', tag: 'nature', region: 'north', name: "Doi Pui Nature Trail", lat: 18.8164, lng: 98.8925, price: "Gratis", desc: "Dennenbossen." },
            { id: 611, rank: 11, type: 'hike', tag: 'nature', region: 'north', name: "Khun Korn Waterfall", lat: 19.8667, lng: 99.5833, price: "Gratis", desc: "Hoogste waterval Chiang Rai." },
            { id: 612, rank: 12, type: 'hike', tag: 'nature', region: 'north', name: "Doi Mon Jong", lat: 17.5503, lng: 98.5367, price: "‚Ç¨ 80,00", desc: "Gouden grasruggen." },
            { id: 626, rank: 26, type: 'hike', tag: 'culture', region: 'north', name: "Wat Chalermprakiat", lat: 18.7414, lng: 99.5394, price: "‚Ç¨ 5,40", desc: "Klim naar witte pagodes op kalksteentoppen." },
            { id: 632, rank: 32, type: 'hike', tag: 'nature', region: 'north', name: "Sticky Waterfalls", lat: 19.0667, lng: 99.0833, price: "Gratis", desc: "Klimmen in de waterval." },
            { id: 651, rank: 51, type: 'hike', tag: 'nature', region: 'east', name: "Phu Kradueng Summit", lat: 16.8833, lng: 101.7833, price: "‚Ç¨ 10,80", desc: "Zware klim naar tafelberg." },
            { id: 654, rank: 54, type: 'hike', tag: 'nature', region: 'east', name: "Sam Pan Bok", lat: 15.7950, lng: 105.3922, price: "Gratis", desc: "Grand Canyon van Thailand." },
            { id: 701, rank: 101, type: 'hike', tag: 'nature', region: 'west', name: "Erawan Tier 7", lat: 14.3683, lng: 99.1439, price: "‚Ç¨ 8,10", desc: "Top van de waterval." },
            { id: 702, rank: 102, type: 'hike', tag: 'nature', region: 'west', name: "Khao Chang Phueak", lat: 14.7000, lng: 98.6000, price: "‚Ç¨ 5,40", desc: "Gevaarlijke bergkam." },
            { id: 707, rank: 107, type: 'hike', tag: 'nature', region: 'south', name: "Phraya Nakhon Cave", lat: 12.2000, lng: 100.0167, price: "‚Ç¨ 5,40", desc: "Grot met paviljoen." },
            { id: 751, rank: 151, type: 'hike', tag: 'nature', region: 'south', name: "Dragon Crest", lat: 8.0833, lng: 98.7667, price: "‚Ç¨ 5,40", desc: "Iconisch uitzichtpunt Krabi." },
            { id: 754, rank: 154, type: 'hike', tag: 'culture', region: 'south', name: "Tiger Cave Temple", lat: 8.1242, lng: 98.9247, price: "Gratis", desc: "1260 treden naar de top." },
            { id: 757, rank: 157, type: 'hike', tag: 'nature', region: 'south', name: "Samet Nangshe", lat: 8.2333, lng: 98.4500, price: "‚Ç¨ 1,35", desc: "Uitzicht op Phang Nga baai." }
];

// --- 1. SETUP ---
const isMobile = window.innerWidth < 600;
const initialZoom = isMobile ? 5 : 6;
const map = L.map('map', { zoomControl: false }).setView([13.0000, 101.5000], initialZoom);
L.control.zoom({ position: 'bottomright' }).addTo(map);
L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '¬© OpenStreetMap' }).addTo(map);

function toggleMenu() { document.getElementById('controls').classList.toggle('active'); }
if(isMobile) document.getElementById('controls').classList.remove('active');

// --- 2. STATE & STORAGE ---
let favorites = JSON.parse(localStorage.getItem('thai_favs')) || [];
let userRate = parseFloat(localStorage.getItem('thai_rate')) || 2.70; 
let userLat = null;
let userLng = null;
let userMarker = null;

if(localStorage.getItem('calc_thb')) document.getElementById('calcTHB').value = localStorage.getItem('calc_thb');
if(localStorage.getItem('calc_eur')) document.getElementById('calcEUR').value = localStorage.getItem('calc_eur');
updateRateDisplay(userRate);

// --- 3. GPS LOCATIE ---
map.locate({setView: false, watch: true, enableHighAccuracy: true});

map.on('locationfound', function(e) {
    userLat = e.latlng.lat;
    userLng = e.latlng.lng;
    if (!userMarker) {
        userMarker = L.circleMarker(e.latlng, { radius: 8, fillColor: "#4285F4", color: "#ffffff", weight: 3, opacity: 1, fillOpacity: 1 }).addTo(map).bindPopup("Jouw Locatie");
    } else {
        userMarker.setLatLng(e.latlng);
    }
    document.getElementById('user-status').innerText = "GPS Actief ‚úÖ";
    renderMarkers(); 
});

map.on('locationerror', function(e) { document.getElementById('user-status').innerText = "GPS niet gevonden ‚ùå"; });

function locateUser() {
    if(userLat && userLng) { map.setView([userLat, userLng], 10); } 
    else { alert("Nog geen GPS signaal. Zorg dat locatie aanstaat en refresh."); }
}

// --- 4. CALCULATOR ---
function calculateRate() {
    const thb = parseFloat(document.getElementById('calcTHB').value);
    const eur = parseFloat(document.getElementById('calcEUR').value);
    if (thb && eur) {
        const rate100 = (eur / thb) * 100;
        userRate = rate100;
        localStorage.setItem('thai_rate', userRate);
        localStorage.setItem('calc_thb', thb);
        localStorage.setItem('calc_eur', eur);
        updateRateDisplay(rate100);
        calcPurchase();
        renderMarkers();
    }
}

function calcPurchase() {
    const priceThb = parseFloat(document.getElementById('purchaseTHB').value);
    if (priceThb) {
        const priceEur = (priceThb / 100) * userRate;
        document.getElementById('purchaseResult').innerText = `‚Ç¨ ${priceEur.toFixed(2)}`;
    } else {
        document.getElementById('purchaseResult').innerText = `‚Ç¨ 0.00`;
    }
}

function updateRateDisplay(rate) { document.getElementById('rateResult').innerHTML = `Koers: 100 THB = <b>‚Ç¨ ${rate.toFixed(2)}</b>`; }

// --- 5. FAVORIETEN ---
function toggleFav(id) {
    if (favorites.includes(id)) { favorites = favorites.filter(fav => fav !== id); } 
    else { favorites.push(id); }
    localStorage.setItem('thai_favs', JSON.stringify(favorites));
    
    const btn = document.getElementById(`fav-btn-${id}`);
    if(btn) {
        btn.className = favorites.includes(id) ? 'fav-btn fav-active' : 'fav-btn fav-inactive';
        btn.innerHTML = favorites.includes(id) ? '‚ù§Ô∏è' : 'ü§ç';
    }
    if(document.getElementById('favFilter').checked) renderMarkers();
}

// --- 6. RENDER ENGINE ---
let markers = [];

function renderMarkers() {
    markers.forEach(m => map.removeLayer(m));
    markers = [];

    const maxRank = parseInt(document.getElementById('rankSlider').value);
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const showFavsOnly = document.getElementById('favFilter').checked;
    const priceFilter = document.getElementById('priceFilter').value;
    
    const catChecked = Array.from(document.querySelectorAll('input[name="cat"]:checked')).map(cb => cb.value);
    const regChecked = Array.from(document.querySelectorAll('input[name="reg"]:checked')).map(cb => cb.value);
    const tagChecked = Array.from(document.querySelectorAll('input[name="tag"]:checked')).map(cb => cb.value);

    const convertPrice = (priceStr) => {
        if (priceStr.toLowerCase().includes('gratis') || priceStr.toLowerCase().includes('donatie') || priceStr.toLowerCase().includes('inbegrepen')) return priceStr;
        let amount = parseFloat(priceStr.replace(/[^0-9,.]/g, '').replace(',', '.'));
        if (!amount) return priceStr;
        let estimatedTHB = (amount / 2.70) * 100; 
        let newEur = (estimatedTHB / 100) * userRate;
        return `‚Ç¨ ${newEur.toFixed(2)}`;
    };

    locations.forEach(loc => {
        if (loc.lat < 5 || loc.lat > 21) return; 
        if (showFavsOnly && !favorites.includes(loc.id)) return;
        if (!showFavsOnly && loc.rank > maxRank) return;
        if (searchTerm && !loc.name.toLowerCase().includes(searchTerm)) return;
        if (!catChecked.includes(loc.type)) return;
        if (!regChecked.includes(loc.region)) return;
        if (!tagChecked.includes(loc.tag)) return;

        if (priceFilter !== 'all') {
            if (priceFilter === 'free' && !loc.price.toLowerCase().includes('gratis')) return;
            const isCheap = loc.price.includes('‚Ç¨ 1') || loc.price.includes('‚Ç¨ 2') || loc.price.includes('‚Ç¨ 3') || loc.price.includes('‚Ç¨ 4');
            const isMid = !isCheap && (parseInt(loc.price.replace(/[^0-9]/g, '')) < 20);
            if (priceFilter === 'cheap' && !isCheap && !loc.price.toLowerCase().includes('gratis')) return;
            if (priceFilter === 'mid' && !isMid) return;
            if (priceFilter === 'high' && (isCheap || isMid || loc.price.toLowerCase().includes('gratis'))) return;
        }

        let iconChar = '';
        if(loc.type === 'sight') iconChar = 'üì∑';
        if(loc.type === 'food') iconChar = 'üçú';
        if(loc.type === 'activity') iconChar = 'üèÑ';
        if(loc.type === 'hike') iconChar = 'ü•æ';
        
        const cssClass = `marker-${loc.type}`;
        const customIcon = L.divIcon({
            className: 'custom-div-icon',
            html: `<div class="custom-pin ${cssClass}">
                    <div class="pin-icon">${iconChar}</div>
                    <div class="rank-badge">${loc.rank}</div>
                   </div>`,
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -45]
        });

        const marker = L.marker([loc.lat, loc.lng], { icon: customIcon }).addTo(map);
        
        let distHtml = '';
        if(userLat) {
            const d = getDistanceFromLatLonInKm(userLat, userLng, loc.lat, loc.lng);
            distHtml = `<span class="distance-tag">üìè ${d.toFixed(1)} km van jou</span>`;
        }

        const isFav = favorites.includes(loc.id);
        const favIcon = isFav ? '‚ù§Ô∏è' : 'ü§ç';
        const favClass = isFav ? 'fav-active' : 'fav-inactive';
        const displayPrice = convertPrice(loc.price);
        const priceColor = displayPrice.includes('Gratis') ? 'green' : '#333';

        const navUrl = `https://www.google.com/maps/search/?api=1&query=${loc.lat},${loc.lng}`;
        const infoUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc.name + " Thailand")}`;
        const ytUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(loc.name + ' Thailand vlog')}`;
        const wikiUrl = `https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(loc.name)}`;

        const popupHtml = `
            <div class="popup-content">
                <div class="popup-header">
                    <div>
                        <div class="category-tag">${loc.type} ‚Ä¢ #${loc.rank}</div>
                        <h3>${loc.name}</h3>
                        ${distHtml}
                    </div>
                    <button id="fav-btn-${loc.id}" class="fav-btn ${favClass}" onclick="toggleFav(${loc.id})">${favIcon}</button>
                </div>
                <div class="desc">${loc.desc}</div>
                <div class="meta-row">
                    <span>üìç ${loc.region.charAt(0).toUpperCase() + loc.region.slice(1)}</span>
                    <span style="color:${priceColor}">${displayPrice}</span>
                </div>
                <div class="btn-grid">
                    <a href="${navUrl}" target="_blank" class="popup-btn btn-nav">üöó Navigeer</a>
                    <a href="${infoUrl}" target="_blank" class="popup-btn btn-google">‚≠ê Info</a>
                    <a href="${ytUrl}" target="_blank" class="popup-btn btn-yt">‚ñ∂ YouTube</a>
                    <a href="${wikiUrl}" target="_blank" class="popup-btn btn-wiki">üìñ Wiki</a>
                </div>
            </div>
        `;

        marker.bindPopup(popupHtml);
        markers.push(marker);
    });
}

function updateSliderVal() { document.getElementById('rankVal').innerText = document.getElementById('rankSlider').value; }

function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
    var R = 6371; var dLat = deg2rad(lat2-lat1); var dLon = deg2rad(lon2-lon1); 
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
    return R * c; 
}
function deg2rad(deg) { return deg * (Math.PI/180); }

document.getElementById('rankSlider').addEventListener('input', (e) => {
    document.getElementById('rankVal').innerText = e.target.value;
    renderMarkers();
});
document.querySelectorAll('input, select').forEach(el => {
    if(el.id !== 'calcTHB' && el.id !== 'calcEUR' && el.id !== 'purchaseTHB') {
        el.addEventListener('change', renderMarkers);
    }
});
document.getElementById('searchInput').addEventListener('keyup', renderMarkers);

renderMarkers();

    </script>
</body>
</html>