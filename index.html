<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thailand Ultimate Guide v5</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        /* Toggle Button */
        #toggle-btn {
            position: absolute; top: 20px; right: 20px;
            background: white; padding: 10px 15px; border-radius: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 1000;
            border: none; font-weight: bold; color: #333; cursor: pointer;
            display: flex; align-items: center; gap: 5px;
        }
        #toggle-btn:hover { background: #f0f0f0; }

        /* Sidebar Controls */
        #controls {
            position: absolute; top: 0; right: 0; height: 100vh; width: 320px; max-width: 90vw;
            background: rgba(255, 255, 255, 0.98); padding: 20px;
            box-shadow: -5px 0 20px rgba(0,0,0,0.2); z-index: 1001;
            overflow-y: auto; transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
        }
        #controls.active { transform: translateX(0); }

        .controls-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #555; padding: 5px; }

        h2 { margin: 0; font-size: 18px; color: #333; }
        h4 { margin: 15px 0 8px 0; font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 800; }

        /* Zoekbalk */
        #searchInput {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc;
            margin-bottom: 15px; font-size: 14px; box-sizing: border-box;
            background-color: #f9f9f9;
        }

        .filter-group label { display: flex; align-items: center; margin-bottom: 8px; cursor: pointer; font-size: 14px; color: #333; }
        input[type="checkbox"] { margin-right: 12px; transform: scale(1.2); accent-color: #007bff; }
        select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; background: #f9f9f9; font-size: 14px; }

        .slider-container { background: #f0f8ff; padding: 10px; border-radius: 8px; margin-bottom: 15px; }
        input[type=range] { width: 100%; margin: 10px 0; cursor: pointer; accent-color: #007bff; }
        .slider-val { font-weight: bold; color: #007bff; float: right; font-size: 16px; }

        /* Custom Pins Styles */
        .custom-pin {
            border-radius: 50% 50% 50% 0;
            border: 3px solid #fff;
            width: 40px; height: 40px;
            transform: rotate(-45deg);
            display: flex !important; align-items: center; justify-content: center;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.4);
            position: relative;
            transition: all 0.2s;
        }
        /* Het icoon in de pin (draaien we terug recht) */
        .pin-icon { transform: rotate(45deg); font-size: 18px; line-height: 1; }
        
        /* De Ranking Badge (klein bolletje rechtsboven) */
        .rank-badge {
            position: absolute;
            top: -5px; right: -5px;
            background: #fff; color: #333;
            border-radius: 50%;
            width: 18px; height: 18px;
            font-size: 10px; font-weight: 900;
            display: flex; align-items: center; justify-content: center;
            transform: rotate(45deg); /* Compenseer rotatie parent */
            border: 2px solid #333;
            z-index: 10;
        }

        .marker-sight { background-color: #007bff; }   /* Blauw */
        .marker-food { background-color: #dc3545; }    /* Rood */
        .marker-activity { background-color: #9c27b0; } /* Paars */
        .marker-hike { background-color: #28a745; }    /* Groen */

        /* Popup */
        .leaflet-popup-content-wrapper { border-radius: 12px; }
        .popup-content { min-width: 240px; }
        .popup-content h3 { margin: 0 0 5px 0; color: #222; font-size: 16px; }
        .popup-content .category { font-size: 10px; font-weight: bold; color: #888; text-transform: uppercase; margin-bottom: 5px; }
        .popup-content .desc { font-size: 13px; color: #555; margin-bottom: 10px; }
        .distance-tag { display: inline-block; background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 11px; margin-bottom: 8px; font-weight: bold; color: #555; }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .full-width { grid-column: 1 / -1; }
        .popup-btn { display: flex; align-items: center; justify-content: center; text-decoration: none; border-radius: 6px; padding: 10px 5px; font-size: 12px; font-weight: bold; color: white; gap: 5px; transition: opacity 0.2s; }
        .popup-btn:hover { opacity: 0.9; }
        
        .btn-google { background: #4285F4; } 
        .btn-nav { background: #34A853; }
        .btn-yt { background: #FF0000; }
        .btn-wiki { background: #555; }

        .loc-btn { width: 100%; padding: 12px; background: #222; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>

    <button id="toggle-btn" onclick="toggleMenu()">‚öôÔ∏è Filters</button>

    <div id="controls" class="active">
        <div class="controls-header">
            <h2>üáπüá≠ Thailand Explorer</h2>
            <button class="close-btn" onclick="toggleMenu()">√ó</button>
        </div>
        
        <input type="text" id="searchInput" placeholder="üîç Zoek op naam (bv. Khao Sok)...">

        <div class="slider-container">
            <h4>üèÜ Ranking Filter</h4>
            <label>Toon Top <span id="rankVal" class="slider-val">50</span></label>
            <input type="range" id="rankSlider" min="1" max="50" value="50">
        </div>

        <div class="filter-group">
            <h4>Type Ervaring</h4>
            <label><input type="checkbox" name="tag" value="nature" checked> üå≥ Natuur</label>
            <label><input type="checkbox" name="tag" value="culture" checked> üèõÔ∏è Cultuur & Stad</label>
        </div>

        <div class="filter-group">
            <h4>Categorie√´n</h4>
            <label><input type="checkbox" name="cat" value="sight" checked> üì∑ Bezienswaardigheden</label>
            <label><input type="checkbox" name="cat" value="food" checked> üçú Eten & Drinken</label>
            <label><input type="checkbox" name="cat" value="activity" checked> üèÑ Activiteiten</label>
            <label><input type="checkbox" name="cat" value="hike" checked> ü•æ Wandelingen</label>
        </div>

        <div class="filter-group">
            <h4>Regio's</h4>
            <label><input type="checkbox" name="reg" value="bangkok" checked> Centraal & Bangkok</label>
            <label><input type="checkbox" name="reg" value="north" checked> Noord (Chiang Mai/Rai)</label>
            <label><input type="checkbox" name="reg" value="south" checked> Zuid (Eilanden/Krabi)</label>
            <label><input type="checkbox" name="reg" value="west" checked> West (Kanchanaburi)</label>
            <label><input type="checkbox" name="reg" value="east" checked> Oost (Pattaya/Isaan)</label>
        </div>

        <div class="filter-group">
            <h4>Prijsklasse</h4>
            <select id="priceFilter">
                <option value="all">Alle prijzen</option>
                <option value="free">Gratis</option>
                <option value="cheap">Budget (< ‚Ç¨5)</option>
                <option value="mid">Gemiddeld (‚Ç¨5 - ‚Ç¨20)</option>
                <option value="high">Luxe (> ‚Ç¨20)</option>
            </select>
        </div>

        <button class="loc-btn" onclick="locateUser()">üìç Mijn Locatie</button>
        <div id="user-status" style="font-size: 11px; margin-top: 5px; color: #666; text-align: center;"></div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        const isMobile = window.innerWidth < 600;
        const initialZoom = isMobile ? 5 : 6;
        const map = L.map('map', { zoomControl: false }).setView([13.0000, 101.5000], initialZoom);
        
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '¬© OpenStreetMap ¬© CARTO',
            maxZoom: 19
        }).addTo(map);

        function toggleMenu() { document.getElementById('controls').classList.toggle('active'); }
        if(isMobile) document.getElementById('controls').classList.remove('active');

        // Global variable for user location
        let userLat = null;
        let userLng = null;

        // DATA: Added 'tag' (nature/culture)
        const locations = [
            // BEZIENSWAARDIGHEDEN
            { rank: 1, type: 'sight', tag: 'culture', region: 'bangkok', name: "The Grand Palace", lat: 13.7500, lng: 100.4915, price: "‚Ç¨ 13,50", desc: "H√©t symbool van Thailand." },
            { rank: 2, type: 'sight', tag: 'culture', region: 'bangkok', name: "Wat Arun", lat: 13.7437, lng: 100.4888, price: "‚Ç¨ 5,40", desc: "Tempel van de Dageraad." },
            { rank: 3, type: 'sight', tag: 'culture', region: 'bangkok', name: "Ayutthaya Historical Park", lat: 14.3532, lng: 100.5684, price: "‚Ç¨ 1,35", desc: "Oude tempelru√Ønes." },
            { rank: 4, type: 'sight', tag: 'nature', region: 'south', name: "Maya Bay (Phi Phi)", lat: 7.6775, lng: 98.7663, price: "‚Ç¨ 10,80", desc: "Beroemd strand uit 'The Beach'." },
            { rank: 5, type: 'sight', tag: 'culture', region: 'north', name: "Wat Phra That Doi Suthep", lat: 18.8048, lng: 98.9216, price: "‚Ç¨ 0,80", desc: "Heilige bergtempel." },
            { rank: 6, type: 'sight', tag: 'nature', region: 'south', name: "Khao Sok National Park", lat: 8.9135, lng: 98.5309, price: "‚Ç¨ 8,10", desc: "Oerwoud en drijvende huisjes." },
            { rank: 7, type: 'sight', tag: 'culture', region: 'bangkok', name: "Damnoen Saduak Market", lat: 13.5195, lng: 99.9577, price: "Gratis (boot ‚Ç¨‚Ç¨)", desc: "Drijvende markt." },
            { rank: 8, type: 'sight', tag: 'culture', region: 'bangkok', name: "Wat Pho", lat: 13.7465, lng: 100.4933, price: "‚Ç¨ 8,10", desc: "Liggende Boeddha." },
            { rank: 9, type: 'sight', tag: 'culture', region: 'west', name: "Bridge over River Kwai", lat: 14.0410, lng: 99.5042, price: "Gratis", desc: "WO2 Historie." },
            { rank: 10, type: 'sight', tag: 'nature', region: 'south', name: "Railay Beach", lat: 8.0110, lng: 98.8373, price: "Gratis", desc: "Kalksteenkliffen strand." },
            { rank: 12, type: 'sight', tag: 'culture', region: 'north', name: "Wat Rong Khun", lat: 19.8243, lng: 99.7632, price: "‚Ç¨ 2,70", desc: "De Witte Tempel." },
            { rank: 13, type: 'sight', tag: 'culture', region: 'north', name: "Sukhothai Historical Park", lat: 17.0163, lng: 99.7036, price: "‚Ç¨ 2,70", desc: "Oerste hoofdstad." },
            { rank: 18, type: 'sight', tag: 'culture', region: 'east', name: "Sanctuary of Truth", lat: 12.9727, lng: 100.8891, price: "‚Ç¨ 13,50", desc: "Houten tempel aan zee." },
            { rank: 25, type: 'sight', tag: 'culture', region: 'bangkok', name: "Jim Thompson House", lat: 13.7495, lng: 100.5283, price: "‚Ç¨ 5,40", desc: "Thais houten huis & zijde." },
            
            // ETEN (Default Culture)
            { rank: 1, type: 'food', tag: 'culture', region: 'bangkok', name: "Raan Jay Fai", lat: 13.7525, lng: 100.5048, price: "‚Ç¨ 20+", desc: "Michelin streetfood (Krabomelet)." },
            { rank: 2, type: 'food', tag: 'culture', region: 'bangkok', name: "Jeh O Chula", lat: 13.7425, lng: 100.5225, price: "‚Ç¨ 6,75", desc: "Tom Yum Mama Noodles." },
            { rank: 3, type: 'food', tag: 'culture', region: 'north', name: "Khao Soi Khun Yai", lat: 18.7953, lng: 98.9831, price: "‚Ç¨ 1,35", desc: "Beste Khao Soi in Chiang Mai." },
            { rank: 4, type: 'food', tag: 'culture', region: 'bangkok', name: "Thipsamai Pad Thai", lat: 13.7528, lng: 100.5048, price: "‚Ç¨ 3,50", desc: "Beroemdste Pad Thai." },
            { rank: 5, type: 'food', tag: 'culture', region: 'bangkok', name: "Wattana Panich", lat: 13.7341, lng: 100.5876, price: "‚Ç¨ 2,70", desc: "50-jaar oude soepbouillon." },
            { rank: 6, type: 'food', tag: 'culture', region: 'south', name: "Tu Kab Khao", lat: 7.8836, lng: 98.3880, price: "‚Ç¨ 12,00", desc: "Zuid-Thais in Phuket Town." },
            { rank: 10, type: 'food', tag: 'culture', region: 'north', name: "Khao Soi Mae Sai", lat: 18.7996, lng: 98.9752, price: "‚Ç¨ 1,35", desc: "Rijke bouillon Khao Soi." },
            { rank: 12, type: 'food', tag: 'culture', region: 'bangkok', name: "Jok Prince", lat: 13.7196, lng: 100.5153, price: "‚Ç¨ 1,50", desc: "Rijstepap ontbijt." },
            { rank: 22, type: 'food', tag: 'culture', region: 'bangkok', name: "T&K Seafood", lat: 13.7410, lng: 100.5085, price: "‚Ç¨ 10,00", desc: "Street seafood in Chinatown." },
            { rank: 30, type: 'food', tag: 'culture', region: 'bangkok', name: "Pier 21 Food Court", lat: 13.7376, lng: 100.5603, price: "‚Ç¨ 1,50", desc: "Goedkoopste schone streetfood." },
            { rank: 32, type: 'food', tag: 'culture', region: 'south', name: "Kodam Kitchen", lat: 8.0336, lng: 98.8286, price: "‚Ç¨ 6,00", desc: "Beste in Ao Nang." },

            // ACTIVITEITEN
            { rank: 1, type: 'activity', tag: 'culture', region: 'bangkok', name: "Thaise Massage (Wat Pho)", lat: 13.7460, lng: 100.4930, price: "‚Ç¨ 8,00", desc: "De bron van de massage." },
            { rank: 4, type: 'activity', tag: 'nature', region: 'north', name: "Olifantenreservaat (ENP)", lat: 19.2155, lng: 98.8606, price: "‚Ç¨ 60,00", desc: "Ethische opvang, no riding." },
            { rank: 5, type: 'activity', tag: 'culture', region: 'bangkok', name: "Kookcursus (Silom)", lat: 13.7242, lng: 100.5234, price: "‚Ç¨ 30,00", desc: "Leer curry maken." },
            { rank: 15, type: 'activity', tag: 'culture', region: 'south', name: "Full Moon Party", lat: 9.6766, lng: 100.0631, price: "‚Ç¨ 3,00", desc: "Strandfeest Koh Phangan." },
            { rank: 28, type: 'activity', tag: 'culture', region: 'bangkok', name: "Sak Yant Tattoo", lat: 13.9168, lng: 100.2078, price: "Donatie", desc: "Heilige tatoeage (Wat Bang Phra)." },
            { rank: 30, type: 'activity', tag: 'culture', region: 'bangkok', name: "Chatuchak Market", lat: 13.7998, lng: 100.5504, price: "Gratis", desc: "Grootste weekendmarkt." },
            { rank: 40, type: 'activity', tag: 'nature', region: 'bangkok', name: "Varanen in Lumpini Park", lat: 13.7314, lng: 100.5414, price: "Gratis", desc: "Stadspark vol dieren." },
            { rank: 50, type: 'activity', tag: 'culture', region: 'bangkok', name: "Ancient City", lat: 13.5390, lng: 100.6226, price: "‚Ç¨ 20,00", desc: "Thailand in het klein." },

            // WANDELINGEN
            { rank: 1, type: 'hike', tag: 'nature', region: 'north', name: "Kew Mae Pan Nature Trail", lat: 18.5527, lng: 98.4801, price: "‚Ç¨ 5,50", desc: "Boven de wolken op Doi Inthanon." },
            { rank: 2, type: 'hike', tag: 'nature', region: 'south', name: "Dragon Crest (Ngorn Nak)", lat: 8.0973, lng: 98.7494, price: "Gratis", desc: "Spectaculair uitzicht Krabi." },
            { rank: 3, type: 'hike', tag: 'nature', region: 'north', name: "Monk's Trail (Wat Pha Lat)", lat: 18.7963, lng: 98.9435, price: "Gratis", desc: "Junglepad naar tempel." },
            { rank: 4, type: 'hike', tag: 'nature', region: 'south', name: "Phraya Nakhon Cave", lat: 12.2059, lng: 100.0102, price: "‚Ç¨ 5,40", desc: "Grot met paviljoen." },
            { rank: 5, type: 'hike', tag: 'nature', region: 'west', name: "Erawan Waterfalls", lat: 14.3755, lng: 99.1440, price: "‚Ç¨ 8,10", desc: "7 waterval niveaus." },
            { rank: 6, type: 'hike', tag: 'nature', region: 'west', name: "Khao Chang Phueak", lat: 14.6543, lng: 98.5413, price: "‚Ç¨ 10,00", desc: "Gevaarlijke bergrug." },
            { rank: 8, type: 'hike', tag: 'nature', region: 'north', name: "Phu Chi Fa", lat: 19.8500, lng: 100.4460, price: "Gratis", desc: "Zonsopgang op klif." },
            { rank: 9, type: 'hike', tag: 'culture', region: 'south', name: "Tiger Cave Temple (1237 treden)", lat: 8.1239, lng: 98.9251, price: "Gratis", desc: "Zware klim naar Boeddha." },
            { rank: 13, type: 'hike', tag: 'nature', region: 'north', name: "Pai Canyon", lat: 19.3060, lng: 98.4526, price: "Gratis", desc: "Smalle zandrichels." },
            { rank: 14, type: 'hike', tag: 'nature', region: 'north', name: "Sticky Waterfalls", lat: 19.0833, lng: 99.0833, price: "Gratis", desc: "In de waterval lopen." },
            { rank: 27, type: 'hike', tag: 'nature', region: 'bangkok', name: "Bang Kachao (Green Lung)", lat: 13.6828, lng: 100.5600, price: "Gratis", desc: "Fietsen/lopen in stad." }
        ];

        let markers = [];

        function renderMarkers() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            const maxRank = parseInt(document.getElementById('rankSlider').value);
            const priceFilter = document.getElementById('priceFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            // Checkboxes values
            const catChecked = Array.from(document.querySelectorAll('input[name="cat"]:checked')).map(cb => cb.value);
            const regChecked = Array.from(document.querySelectorAll('input[name="reg"]:checked')).map(cb => cb.value);
            const tagChecked = Array.from(document.querySelectorAll('input[name="tag"]:checked')).map(cb => cb.value);

            locations.forEach(loc => {
                // 1. Geofence
                if (loc.lat < 5 || loc.lat > 21) return;

                // 2. Search Filter
                if (searchTerm && !loc.name.toLowerCase().includes(searchTerm)) return;

                // 3. Ranking Filter
                if (loc.rank > maxRank) return;

                // 4. Category Filter
                if (!catChecked.includes(loc.type)) return;

                // 5. Region Filter
                if (!regChecked.includes(loc.region)) return;

                // 6. Nature/Culture Filter
                if (!tagChecked.includes(loc.tag)) return;
                
                // 7. Price Filter
                if (priceFilter !== 'all') {
                    if (priceFilter === 'free' && !loc.price.toLowerCase().includes('gratis')) return;
                    const isCheap = loc.price.includes('‚Ç¨ 1') || loc.price.includes('‚Ç¨ 2') || loc.price.includes('‚Ç¨ 3') || loc.price.includes('‚Ç¨ 4');
                    const isMid = !isCheap && (parseInt(loc.price.replace(/[^0-9]/g, '')) < 20);
                    if (priceFilter === 'cheap' && !isCheap && !loc.price.toLowerCase().includes('gratis')) return;
                    if (priceFilter === 'mid' && !isMid) return;
                    if (priceFilter === 'high' && (isCheap || isMid || loc.price.toLowerCase().includes('gratis'))) return;
                }

                // Determine Icon and Color
                const cssClass = `marker-${loc.type}`;
                let iconChar = '';
                if(loc.type === 'sight') iconChar = 'üì∑';
                if(loc.type === 'food') iconChar = 'üçú';
                if(loc.type === 'activity') iconChar = 'üèÑ';
                if(loc.type === 'hike') iconChar = 'ü•æ';

                // Create Marker Icon with Badge
                const customIcon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `
                        <div class="custom-pin ${cssClass}">
                            <div class="pin-icon">${iconChar}</div>
                            <div class="rank-badge">${loc.rank}</div>
                        </div>`,
                    iconSize: [40, 40],
                    iconAnchor: [20, 40],
                    popupAnchor: [0, -45]
                });

                const marker = L.marker([loc.lat, loc.lng], { icon: customIcon }).addTo(map);
                
                // Calculate Distance
                let distanceHtml = '';
                if (userLat && userLng) {
                    const distKm = getDistanceFromLatLonInKm(userLat, userLng, loc.lat, loc.lng);
                    distanceHtml = `<div class="distance-tag">üìè ${distKm.toFixed(1)} km van jou</div>`;
                }

                // Links
                const navUrl = `https://www.google.com/maps/dir/?api=1&destination=${loc.lat},${loc.lng}`;
                const infoUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc.name + " Thailand")}`;
                const ytUrl = `https://www.youtube.com/results?search_query=${encodeURIComponent(loc.name + ' Thailand vlog')}`;
                const wikiUrl = `https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(loc.name)}`;

                const popupContent = `
                    <div class="popup-content">
                        <div class="category">${getTypeName(loc.type)} ‚Ä¢ Nr. ${loc.rank}</div>
                        <h3>${loc.name}</h3>
                        ${distanceHtml}
                        <div class="desc">${loc.desc}</div>
                        <div style="font-size:12px; margin-bottom:10px;">
                            üìç ${getRegionName(loc.region)} <br>
                            üí∞ <span style="color:${loc.price.includes('Gratis') ? 'green' : '#333'}">${loc.price}</span>
                        </div>
                        
                        <div class="btn-grid">
                            <a href="${infoUrl}" target="_blank" class="popup-btn btn-google full-width">‚≠ê Info & Reviews</a>
                            <a href="${navUrl}" target="_blank" class="popup-btn btn-nav">üöó Navigeer</a>
                            <a href="${ytUrl}" target="_blank" class="popup-btn btn-yt">‚ñ∂ YouTube</a>
                            <a href="${wikiUrl}" target="_blank" class="popup-btn btn-wiki full-width">üìñ Wikipedia</a>
                        </div>
                    </div>
                `;

                marker.bindPopup(popupContent);
                markers.push(marker);
            });
        }

        // Distance Calculator (Haversine)
        function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
            var R = 6371; // Radius of earth in km
            var dLat = deg2rad(lat2-lat1);  
            var dLon = deg2rad(lon2-lon1); 
            var a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            var d = R * c; 
            return d;
        }
        function deg2rad(deg) { return deg * (Math.PI/180); }

        function getTypeName(type) {
            const types = { 'sight': 'Bezienswaardigheid', 'food': 'Eten', 'activity': 'Activiteit', 'hike': 'Wandeling' };
            return types[type] || type;
        }

        function getRegionName(reg) {
            const regs = { 'bangkok': 'Centraal', 'north': 'Noord', 'south': 'Zuid', 'west': 'West', 'east': 'Oost' };
            return regs[reg] || reg;
        }

        function locateUser() {
            const statusDiv = document.getElementById('user-status');
            if (!navigator.geolocation) { statusDiv.innerText = "Geen GPS."; return; }
            statusDiv.innerText = "Locatie zoeken...";
            navigator.geolocation.getCurrentPosition((pos) => {
                userLat = pos.coords.latitude;
                userLng = pos.coords.longitude;
                
                // Remove old user marker if exists
                map.eachLayer((layer) => { if(layer.options.title === 'user') map.removeLayer(layer); });

                L.marker([userLat, userLng], {title: 'user'}).addTo(map).bindPopup("<b>Jij bent hier</b>").openPopup();
                map.setView([userLat, userLng], 9);
                statusDiv.innerText = "Locatie gevonden! Afstanden berekend.";
                
                // Re-render markers to show distance
                renderMarkers();
            }, () => { statusDiv.innerText = "Kan locatie niet bepalen."; });
        }

        // Event Listeners
        document.getElementById('rankSlider').addEventListener('input', (e) => {
            document.getElementById('rankVal').innerText = e.target.value;
            renderMarkers();
        });
        document.getElementById('searchInput').addEventListener('input', renderMarkers);
        document.querySelectorAll('input, select').forEach(el => el.addEventListener('change', renderMarkers));

        renderMarkers();

    </script>
</body>
</html>
